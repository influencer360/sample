!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s=(new Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="e22480cc-af83-423c-a70d-35eb741a791b",e._sentryDebugIdIdentifier="sentry-dbid-e22480cc-af83-423c-a70d-35eb741a791b")}catch(e){}}();var _global2="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global2._sentryModuleMetadata=_global2._sentryModuleMetadata||{},_global2._sentryModuleMetadata[(new Error).stack]={appName:"hs-app-composer",release:"433c728496773fb6b9881b21f96769818607f98f"};var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"433c728496773fb6b9881b21f96769818607f98f"},(self.webpackChunkhs_app_composer=self.webpackChunkhs_app_composer||[]).push([[818],{32657:(e,s,t)=>{t.r(s),t.d(s,{default:()=>B});var i=t(67294),r=t(27361),n=t.n(r),a=t(41609),l=t.n(a),o=t(18446),d=t.n(o),c=t(38546),h=t.n(c),p=t(36005),m=t(85658),P=t(13632),E=t(51023),u=t(21886),f=t(89509),g=t(98781),b=t(28936),I=t(37311),w=t(49198),k=t(87388),_=t(19609),N=t(91725),v=t(89790),y=t(7512),L=t(50886),C=t(40445),D=t(64713),S=t(28951),V=t(13131),W=t(24900),Z=t(1576),U=t(69210),O=t(52917);const M=()=>{},A=_.Z._("This link preview cannot be customized"),R="rc-LinkPreviewPanel",F=(0,f.Ie)((()=>i.createElement(E.z,{fill:(0,f.u_)((e=>e.colors.darkGrey))})));class T extends i.PureComponent{constructor(e){super(e),this.verifyDomain=(e,s)=>{(0,w.tF)(e,s).then((e=>{if(e.urlOwnershipPermissions&&Array.isArray(e.urlOwnershipPermissions)){const s=e.urlOwnershipPermissions.some((e=>e.canCustomizeUrl)),t=e.urlOwnershipPermissions.reduce(((e,s)=>(s.canCustomizeUrl&&e.push(s.socialProfileId),e)),[]);this.setState({facebookAllowsCustomization:s}),this.props.onVerifyDomain(t)}})).catch((e=>{m.Z.isCancel(e)||(0,u.H)(L.Z.NEW_COMPOSER,"Failed during verify domain",{errorMessage:JSON.stringify(e.message),stack:JSON.stringify(e.stack)})}))},this.handleCancel=()=>{const e=(0,O.M)(this.state.linkPreview);this.setState({mode:y.Z.LINK_PREVIEW_MODES.PREVIEW,linkPreview:e})},this.handleSave=e=>{const s=(0,O.M)(e);if((0,k.cr)("PUB_31031_UPLOAD_LI_THUMBNAILS")&&(!l()(s.thumbnailUrl)||!l()(s.thumbnailUrls))){const e=S.ZP.removeErrors(this.props.fieldValidations,[v.Kg.FE_PREVIEW_THUMBNAIL_UNAVAILABLE]);I.Nw.updateFieldById(this.props.messageId,[y.Z.FIELD_TO_UPDATE.FIELD_VALIDATIONS],e)}this.props.onChange(this.props.messageId,s),this.setState({mode:y.Z.LINK_PREVIEW_MODES.PREVIEW})},this.handleEditClick=()=>{this.setState({mode:y.Z.LINK_PREVIEW_MODES.EDIT})},this.canEditPreview=()=>!p.ZP.isEmpty(this.props.fbPageIds)&&this.state.facebookAllowsCustomization||C.Z.hasLinkedInNetwork(...this.props.socialNetworksToDisplay),this.handleDismissFacebookWarning=()=>{this.setState({facebookWarningVisible:!1})},this.handleClose=()=>{this.props.linkScrapeInProgress&&(0,w.I)(),this.props.onRemove()},this._statusObject=D.Z,this.state={facebookAllowsCustomization:!1,facebookWarningVisible:!0,mode:y.Z.LINK_PREVIEW_MODES.PREVIEW,isRescrapeLoading:!1,linkPreview:{}},this.unsubscribeObservers=[M]}componentDidMount(){this.unsubscribeObservers=[(0,N.S)(I.h,(e=>{const s=this.state.linkPreview;if(this.setState({linkPreview:e}),this.hasLinkPreviewChanged(s,e)){const{fbPageIds:s}=this.props;Array.isArray(s)&&s.length&&e.url&&this.verifyDomain(s,e.url)}}),(e=>(0,I.d2)(e,"urlPreview",!1)),d())];const{linkPreview:e}=this.state;p.ZP.isEmpty(e)||!e.originalUrl||p.ZP.isEmpty(this.props.fbPageIds)||this.verifyDomain(this.props.fbPageIds,e.url)}componentWillUnmount(){(0,w.I)(),h()(this.unsubscribeObservers)()}UNSAFE_componentWillReceiveProps(e){if(!p.ZP.isEqual(this.props,e)){if(this.hasFbPageIdsChanged(this.props,e)){const s=n()(this,"state.linkPreview.url");s&&this.verifyDomain(e.fbPageIds,s)}p.ZP.isEmpty(e.fbPageIds)&&this.setState({facebookAllowsCustomization:!1})}}hasFbPageIdsChanged(e,s){const t=!p.ZP.isEqual(e.fbPageIds,s.fbPageIds);return!p.ZP.isEmpty(s.fbPageIds)&&(t?p.ZP.difference(s.fbPageIds,e.fbPageIds).length>0:t)}hasLinkPreviewChanged(e,s){const t=!p.ZP.isEqual(e,s);return!(p.ZP.isEmpty(s)||!s.originalUrl)&&t}renderLoader(){return i.createElement(U.i6,{className:"-contentPanel"},i.createElement(U.AL,{className:"-loaderPanel"},i.createElement(F,null)))}renderFooter(e){return this.state.mode===y.Z.LINK_PREVIEW_MODES.PREVIEW&&this.canEditPreview()?i.createElement(Z.Z,{hasError:e,onEdit:this.handleEditClick}):null}renderPanel(e){let s=null;switch(this.state.mode){case y.Z.LINK_PREVIEW_MODES.PREVIEW:s=[this.renderPreviewPanel(e)];break;case y.Z.LINK_PREVIEW_MODES.EDIT:s=[this.renderEditPanel()]}return i.createElement(U.i6,{className:"-contentPanel"},s)}renderPreviewPanel(e){const s=this.state.linkPreview;let t=(0,O.M)(s);this.canEditPreview()||(t=(0,O.M)(this.props.unEditedUrlPreview));let r=null;t.thumbnailUrl&&(r=i.createElement(U.tw,{className:"-leftPanel"},i.createElement(b.Z,{url:t.thumbnailUrl,size:"100px"})));let n=null;t.originalUrl&&(n=i.createElement(U.wo,{className:"-link"},t.originalUrl));const a=t.title?i.createElement(U.X2,{className:"-title"},t.title):null,l=t.description?i.createElement(U.QU,{className:"-description"},t.description):null;return i.createElement(U.ke,{hasError:e,className:"-previewPanel",key:"-previewPanel"},r,i.createElement(U.TU,{className:"-rightPanel"},a,l,n))}renderEditPanel(){return i.createElement(W.ZP,{key:"-editPanel",onCancel:this.handleCancel,onSave:this.handleSave,linkPreview:this.state.linkPreview,socialNetworkNamesForWarning:this.props.socialNetworkNamesForWarning,numberOfNetworksNotCustomized:this.getNumberOfMessages(this.props)-this.props.numberOfLinkedInAndFBPageNetworks,onDismissFacebookWarning:this.handleDismissFacebookWarning,facebookWarningVisible:this.state.facebookWarningVisible,facadeApiUrl:this.props.facadeApiUrl,csrf:this.props.csrf,trackingContext:this.props.trackingContext,messageId:this.props.messageId,mainComponentClassName:R})}renderCloseButton(){return i.createElement(V.Z,{onClick:this.handleClose})}getNumberOfMessages(e){let s=0;return e&&e.messages&&e.messages[0]&&e.messages[0].messages&&e.messages[0].messages.length&&(s=e.messages[0].messages.length),s}renderPreviewValidation(){if((0,k.cr)("PUB_31031_UPLOAD_LI_THUMBNAILS"))return i.createElement(g.jl,{fieldValidations:this.props.fieldValidations,field:v.rz.LINK_PREVIEW,type:v.Z9.LINK_PREVIEW,isBulkComposer:!1,isPageLevel:!0,errorProps:{shouldHideTitle:!0}})}render(){const{linkPreview:e}=this.state,{error:s,hasMedia:t,linkScrapeInProgress:r}=this.props,n="string"==typeof s&&s.length>0;return e&&!t?i.createElement(U.Uf,{className:R},this.state.mode===y.Z.LINK_PREVIEW_MODES.PREVIEW?this.renderCloseButton():null,this.renderPanel(n),this.renderFooter(n),n&&i.createElement(P.gN,{messageText:s,titleText:A,type:P.A_}),this.renderPreviewValidation()):r?i.createElement(U.Uf,{className:R},this.renderCloseButton(),this.renderLoader()):null}}T.displayName="Link Preview",T.defaultProps={fbPageIds:[],linkScrapeInProgress:!1,onVerifyDomain:M,socialNetworkNamesForWarning:[],socialNetworksToDisplay:[],error:null,unEditedUrlPreview:{},warning:null};const B=T}}]);
//# sourceMappingURL=818.bundle.js.map