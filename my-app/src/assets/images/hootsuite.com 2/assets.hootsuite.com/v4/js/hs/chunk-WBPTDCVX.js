import{a as b,b as ke}from"./chunk-DX7QGVHW.js";import{a as z,b as Ie}from"./chunk-5D3K6GYC.js";import{c as Ne}from"./chunk-SHTS4IQB.js";import{a as Ce}from"./chunk-JRESDEDW.js";import{b as Te}from"./chunk-INSRYSWJ.js";import{a as S}from"./chunk-5M6X2SDJ.js";import{b as c,f as g}from"./chunk-62VJZGPO.js";var _e,P,w,F=c(()=>{Ne();_e=function(e){return Date.parse(e)},P=0,w={init:function(){ajaxCall({type:"GET",url:"/api/2/misc/get-status"},"q1").done(function(e,t,r){var n=r.getResponseHeader("Date"),a=new Date(_e(n)),o=Date.now();P=o-a.getTime()})},now:function(){var e=Date.now();return new Date(e-P)}}});function x(e){return e=typeof e<"u"?e:B,e+"."}function E(e,t){return x(e)+t}function J(e){e=typeof e<"u"?e:B;var t=[],r,n=null;for(r=0,n=sessionStorage.length;r<n;++r)t[t.length]=sessionStorage.key(r);var a=x(e);return I.default.filter(t,function(o){return o.indexOf(a)===0})}var I,B,C,m,u,A=c(()=>{I=g(S()),B="default",C=null;m={supported:function(){if(C===null)try{C="sessionStorage"in window&&window.sessionStorage!==null}catch{C=!1}return C},setItem:function(e,t,r){if(!m.supported())return!1;var n=E(e,t),a=JSON.stringify(r);return sessionStorage.setItem(n,a),!0},getItem:function(e,t){if(!m.supported())return null;var r=E(e,t),n=null;return n=sessionStorage.getItem(r),typeof n>"u"?null:JSON.parse(n)},removeItem:function(e,t){if(!!m.supported()){var r=E(e,t);sessionStorage.removeItem(r)}},clear:function(e){if(!!m.supported()){var t=J(e);I.default.map(t,function(r){sessionStorage.removeItem(r)})}},getKeys:function(e){if(!m.supported())return[];var t=J(e),r=x(e).length;return I.default.map(t,function(n){return n.substring(r)})}},u=m});var Q,V,be,R,K,Ee,W,X=c(()=>{A();Q="uniqueID",V="batchCursor",be=function(){var e=u.getItem(Q,V);e===null&&(e=0);var t=e+100;return u.setItem(Q,V,t),{batchCursor:e,batchLimit:t}},R=null,K=null,Ee=function(){if(R===null||K>=R){var e=be();K=e.batchCursor,R=e.batchLimit}return++K},W={create:function(e){var t=Ee()+"";return e?e+t:t}}});var Z,d,G,D,U,H,$,xe,Ae,Re,Ke,Y,j,He,De,Ue,je,Me,h,ee=c(()=>{Z=g(S());A();X();d="localQueue",G=function(e){return"stream_"+e},D=function(e){return"node_"+e},U=function(e){return"data_"+e},H=function(e){var t=D(e);return u.getItem(d,t)},$=function(e){var t=D(e.nodeId);u.setItem(d,t,e)},xe=function(e){var t=D(e);u.removeItem(d,t),Ke(e)},Ae=function(e){var t=U(e);return u.getItem(d,t)},Re=function(e,t){var r=U(e);u.setItem(d,r,t)},Ke=function(e){var t=U(e);u.removeItem(d,t)},Y=function(e,t){var r=u.getItem(d,G(e));return r==null&&t&&(r={name:e,headNodeId:null},j(r)),r},j=function(e){var t=e.name;u.setItem(d,G(t),e)},He=function(e){if(e.headNodeId===null)return null;for(var t=H(e.headNodeId);t.nextNodeId!==null;)t=H(t.nextNodeId);return t},De=function(e,t){var r=Me(t),n=He(e);n===null?(e.headNodeId=r.nodeId,j(e)):(n.nextNodeId=r.nodeId,$(n))},Ue=function(e,t){if(e.headNodeId===null)return[];for(var r=[],n=e.headNodeId,a=null,o=0;o<t&&n!==null;o++)a=H(n),r[r.length]=a.nodeId,n=a.nextNodeId;return e.headNodeId=n,j(e),Z.default.map(r,function(i){var s=Ae(i);return xe(i),s})},je=function(){return W.create("queueNode_")},Me=function(e){var t=je();Re(t,e);var r={nodeId:t,nextNodeId:null};return $(r),r},h={putRecord:function(e,t){if(!(typeof e>"u")){var r=Y(e,!0);De(r,t)}},getRecords:function(e,t){if(typeof e>"u")return[];var r=Y(e,!1);return r===null?[]:Ue(r,t)}}});function re(){this.pCredentials=null}var te,qe,Le,Oe,ne,ae=c(()=>{te=g(S()),qe=hs.util.getUrlRoot(),Le=`${qe}/ajax/event-tracking/access-tokens`,Oe=function(){return fetch(Le,{method:"GET",credentials:"include",mode:"cors",headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("No credentials in response");return e.json()}).then(e=>{if(!e.accessTokens)throw new Error("No credentials in response");return{accessKeyId:e.accessTokens.key,secretAccessKey:e.accessTokens.secret,sessionToken:e.accessTokens.token}})};te.default.extend(re.prototype,{markCredentialsInvalid:function(){this.pCredentials=null},getCredentials:function(){return this.pCredentials===null&&(this.pCredentials=Oe()),this.pCredentials}});ne=new re});async function oe(e){let t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return se(r)}function se(e){return Array.from(new Uint8Array(e)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function y(e,t){let r=await window.crypto.subtle.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]),n=new TextEncoder("utf-8").encode(e);return await window.crypto.subtle.sign("HMAC",r,n)}var T,M,ie,ze,l,ue=c(()=>{T=function(e,t){return e.toLowerCase()+":"+t},M=function(e){return e.split("T")[0]};ie=function(e,t,r){return e+"/"+r+"/"+t+"/aws4_request"},ze={signedHeaders:"content-type;host;x-amz-date;x-amz-target",createCanonicalRequest:async function(e,t,r,n,a,o,i){e=e.toUpperCase(),t=t.toLowerCase();var s=await oe(i),f="",v=[T("content-type",a),T("host",t),T("x-amz-date",n),T("x-amz-target",o),""].join(`
`);return[e,r,f,v,this.signedHeaders,s].join(`
`)},createStringToSign:async function(e,t,r,n){e=e.toLowerCase(),t=t.toLowerCase();var a="AWS4-HMAC-SHA256",o=M(r),i=ie(o,e,t),s=await oe(n);return[a,r,i,s].join(`
`)},computeSigningKey:async function(e,t,r,n){t=t.toLowerCase(),r=r.toLowerCase();var a=M(n),o=await y(a,new TextEncoder("utf-8").encode("AWS4"+e)),i=await y(r,o),s=await y(t,i);return await y("aws4_request",s)},calculateSignature:async function(e,t){return se(await y(e,t))},createAuthorizationHeader:function(e,t,r,n,a){var o="AWS4-HMAC-SHA256",i=M(n),s=e+"/"+ie(i,t,r);return[o+" Credential="+s,"SignedHeaders="+this.signedHeaders,"Signature="+a].join(", ")},getFormattedTimestamp:function(e){e=e instanceof Date?e:new Date;var t=e.getUTCFullYear().toString(),r=(e.getUTCMonth()+1).toString(),n=e.getUTCDate().toString(),a=e.getUTCHours().toString(),o=e.getUTCMinutes().toString(),i=e.getUTCSeconds().toString();return t+(r[1]?r:"0"+r[0])+(n[1]?n:"0"+n[0])+"T"+(a[1]?a:"0"+a[0])+(o[1]?o:"0"+o[0])+(i[1]?i:"0"+i[0])+"Z"}},l=ze});var Pe,ce,Fe,Je,q,de=c(()=>{ae();ue();Pe=async function(e,t,r,n){var a="kinesis",o="kinesis.us-east-1.amazonaws.com",i="us-east-1",s="/",f="application/x-amz-json-1.1; charset=UTF-8",v=JSON.stringify(r),p=l.getFormattedTimestamp(),pe=await l.createCanonicalRequest(t,o,s,p,f,n,v),he=await l.createStringToSign(a,i,p,pe),ye=await l.computeSigningKey(e.secretAccessKey,a,i,p),Se=await l.calculateSignature(he,ye),we=l.createAuthorizationHeader(e.accessKeyId,a,i,p,Se);return fetch("https://"+o,{method:t,headers:Object.assign({"X-Amz-Date":p,Authorization:we,"X-Amz-Target":n,"Content-Type":f},e.sessionToken!==void 0&&{"X-Amz-Security-Token":e.sessionToken}),body:v}).then(O=>{if(O.ok)return O.json();throw new Error("Could not send a request to kinesis")})},ce=function(e,t){return e.getCredentials().then(function(r){return Pe(r,"POST",t,"Kinesis_20131202.PutRecords")})},Fe=function(e){let t=[],r=new Uint8Array(e);for(let n=0,a=r.byteLength;n<a;n++)t.push(String.fromCharCode(r[n]));return btoa(t.join(""))},Je={createRecord:function(e,t){return e=typeof e=="string"?e:JSON.stringify(e),t=typeof t=="string"?t:JSON.stringify(t),e=Fe(new TextEncoder().encode(e)),{Data:e,PartitionKey:t}},putRecords:function(e,t){var r={Records:t,StreamName:e},n=ne,a=ce(n,r);a.catch(function(){n.markCredentialsInvalid(),ce(n,r)})}},q=Je});var L,k,fe,_,Be,N,le,ve,Qe,ge,Ve,me,vt,We=c(()=>{L=g(Ce()),k=g(S());Ie();ee();F();de();ke();fe=g(Te()),_="datalab-events",Be=500;hs.env==="production"?N="events.us-east-1":hs.env==="staging"?N="frontend.staging":N="dashboard-frontend.dev";le=function(e){var t=(0,L.default)(e.currentTarget),r=t.data("tracking-origin"),n=t.data("tracking-action"),a={actor:hs.memberId,action:n,origin:r,timestamp:z.isFeatureEnabled("DATA_588_ADD_UX_EVENT_MILLISECONDS")?w.now().dateString("yyyy-MM-dd'T'HH:mm:ss.SSS"):w.now()};ge(a),hs.memberId!==null&&h.putRecord(_,a)},ve=function(e,t,r){var n={actor:hs.memberId,action:t,origin:e,timestamp:w.now()};if(ge(n),hs.memberId!==null){var a=function(v){return JSON?JSON.stringify(v):""};if(hs.isFeatureEnabled("DT_2387_INCREASE_EVENT_DETAIL_SIZE")){var o=2048;if(!k.default.isUndefined(r)){var i=a(r).length>o;i?(n.details={max_frontend_size_exceeded:"TRUE"},b.buffer({errorMsg:"Custom event details exceeded max length of "+o+". Origin was "+e+" and action was "+t,lineNumber:1,file:"dashboard/static/js/src/utils/tracker-datalab.js"})):n.details=r}h.putRecord(_,n)}else{var s=512;if(!k.default.isUndefined(r)){var f=a(r).length>s;f?b.buffer({errorMsg:"Custom event details removed - exceeded max length of "+s+". Origin was "+e+" and action was "+t,lineNumber:1,file:"dashboard/static/js/src/utils/tracker-datalab.js"}):n.details=r}h.putRecord(_,n)}}},Qe=function(){var e=h.getRecords(_,Be);if(e.length!==0){var t=k.default.map(e,function(r){return q.createRecord(r,r.actor)});q.putRecords(N,t)}},ge=function(e){hs&&!hs.memberId&&hs.dataLayerTrack&&hs.dataLayerTrack({event:"google_analytics_auto_tagging_event",event_category:"datalab",event_action:e.action,event_label:e.origin})},Ve=function(){fe.default.on("hs.app.web.tracked_event_occurred",function(e,t,r){ve(e,t,r)})},me={init:function(e,t=!0){if(t){var r=(0,L.default)(e),n="a[data-tracking-origin],button[data-tracking-origin]";if(r.data("tracking-listener-attached"))return;r.on("click",n,le),r.data("tracking-listener-attached",!0)}setInterval(Qe,3e3),Ve()},track:le,trackCustom:ve};hs.trackerDatalab=me;vt=me});export{u as a,A as b,W as c,X as d,w as e,F as f,vt as g,We as h};
//# sourceMappingURL=chunk-WBPTDCVX.js.map
