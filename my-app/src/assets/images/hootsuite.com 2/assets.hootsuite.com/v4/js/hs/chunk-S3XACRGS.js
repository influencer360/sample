import{a as Fo}from"./chunk-3KRYVZVM.js";import{a as kr,c as Xe,g as Gr,h as Je,i as Kr,j as Br,l as jr,m as zr,n as Hr,o as qr,p as Yr,s as Wr}from"./chunk-S3IS3DRO.js";import{a as Vo,b as de}from"./chunk-XUS6IAYG.js";import{a as We,e as xr,f as Ot,h as wo}from"./chunk-BUPZWSPL.js";import{a as Mr}from"./chunk-EAS5SCWN.js";import{b as Co}from"./chunk-M42VXZTJ.js";import{a as Po}from"./chunk-NWKOIDHD.js";import{a as ae}from"./chunk-HWDIAN4C.js";import{a as we}from"./chunk-JMUJZFCQ.js";import{g as Ye,h as Fr}from"./chunk-WBPTDCVX.js";import{b as Lo}from"./chunk-INSRYSWJ.js";import{a as Do}from"./chunk-GJN5ONR7.js";import{c as A,f as V}from"./chunk-62VJZGPO.js";var Nt=A(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});var Qe=Mr();Tt.trackGAEvent=function(t){Qe.env()===Qe.STAGING||Qe.env()===Qe.PRODUCTION?(window.dataLayer=window.dataLayer||[],window.dataLayer.push(t)):console.warn("This would have sent the following data to Google Analytics, but GA tracking is disabled in dev. Use staging or production instead. "+JSON.stringify(t))}});var xt=A(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});var Vt=function(){function t(){}return t.prototype.handleError=function(e){},t}();Oe.NoopErrorHandler=Vt;var Ft=new Vt;function ss(t){Ft=t}Oe.setErrorHandler=ss;function us(){return Ft}Oe.getErrorHandler=us;function ls(){Ft=new Vt}Oe.resetErrorHandler=ls});var Mt=A(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});var cs;(function(t){t[t.NOTSET=0]="NOTSET",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARNING=3]="WARNING",t[t.ERROR=4]="ERROR"})(cs=et.LogLevel||(et.LogLevel={}))});var Bt=A((Ef,Kt)=>{var pi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);pi?(kt=new Uint8Array(16),Kt.exports=function(){return pi(kt),kt}):(Gt=new Array(16),Kt.exports=function(){for(var e=0,r;e<16;e++)(e&3)===0&&(r=Math.random()*4294967296),Gt[e]=r>>>((e&3)<<3)&255;return Gt});var kt,Gt});var jt=A((gf,gi)=>{var Ei=[];for(Fe=0;Fe<256;++Fe)Ei[Fe]=(Fe+256).toString(16).substr(1);var Fe;function fs(t,e){var r=e||0,i=Ei;return[i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]]].join("")}gi.exports=fs});var hi=A((vf,_i)=>{var ds=Bt(),ps=jt(),vi,zt,Ht=0,qt=0;function Es(t,e,r){var i=e&&r||0,n=e||[];t=t||{};var o=t.node||vi,a=t.clockseq!==void 0?t.clockseq:zt;if(o==null||a==null){var u=ds();o==null&&(o=vi=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),a==null&&(a=zt=(u[6]<<8|u[7])&16383)}var s=t.msecs!==void 0?t.msecs:new Date().getTime(),l=t.nsecs!==void 0?t.nsecs:qt+1,c=s-Ht+(l-qt)/1e4;if(c<0&&t.clockseq===void 0&&(a=a+1&16383),(c<0||s>Ht)&&t.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ht=s,qt=l,zt=a,s+=122192928e5;var f=((s&268435455)*1e4+l)%4294967296;n[i++]=f>>>24&255,n[i++]=f>>>16&255,n[i++]=f>>>8&255,n[i++]=f&255;var E=s/4294967296*1e4&268435455;n[i++]=E>>>8&255,n[i++]=E&255,n[i++]=E>>>24&15|16,n[i++]=E>>>16&255,n[i++]=a>>>8|128,n[i++]=a&255;for(var v=0;v<6;++v)n[i+v]=o[v];return e||ps(n)}_i.exports=Es});var yi=A((_f,Ii)=>{var gs=Bt(),vs=jt();function _s(t,e,r){var i=e&&r||0;typeof t=="string"&&(e=t==="binary"?new Array(16):null,t=null),t=t||{};var n=t.random||(t.rng||gs)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e)for(var o=0;o<16;++o)e[i+o]=n[o];return e||vs(n)}Ii.exports=_s});var Wt=A((hf,Oi)=>{var Is=hi(),mi=yi(),Yt=mi;Yt.v1=Is;Yt.v4=mi;Oi.exports=Yt});var Re=A(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});var ys=Wt();function ms(){return ys.v4()}j.generateUUID=ms;function Os(){return new Date().getTime()}j.getTimestamp=Os;function Rs(t,e){for(var r=!1,i=Object.keys(t),n=0;n<i.length;n++)if(e===t[i[n]]){r=!0;break}return r}j.isValidEnum=Rs;function Ts(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=r[n]||[],r[n].push(i)}),Ri(r)}j.groupBy=Ts;function Ri(t){return Object.keys(t).map(function(e){return t[e]})}j.objectValues=Ri;function Ns(t){return Object.keys(t).map(function(e){return[e,t[e]]})}j.objectEntries=Ns;function As(t,e){for(var r,i=0,n=t;i<n.length;i++){var o=n[i];if(e(o)){r=o;break}}return r}j.find=As;function bs(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=i}),r}j.keyBy=bs;function Us(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=0;return t.replace(/%s/g,function(){var n=e[i++],o=typeof n;return o==="function"?n():o==="string"?n:String(n)})}j.sprintf=Us;var Ss;(function(t){t.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",t.DECISION="DECISION:type, userId, attributes, decisionInfo",t.LOG_EVENT="LOG_EVENT:logEvent",t.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",t.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"})(Ss=j.NOTIFICATION_TYPES||(j.NOTIFICATION_TYPES={}))});var Ui=A($=>{"use strict";var Ds=$&&$.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,n++)i[n]=o[a];return i};Object.defineProperty($,"__esModule",{value:!0});var Ls=xt(),tt=Re(),P=Mt(),Ti={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function Jt(t){return typeof t!="string"||(t=t.toUpperCase(),t==="WARN"&&(t="WARNING"),!Ti[t])?t:Ti[t]}var Ai=function(){function t(){this.defaultLoggerFacade=new Ni,this.loggers={}}return t.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new Ni({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},t}(),Cs=function(){function t(e){e===void 0&&(e={}),this.logLevel=P.LogLevel.NOTSET,e.logLevel!==void 0&&tt.isValidEnum(P.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=e.logToConsole!==void 0?!!e.logToConsole:!0,this.prefix=e.prefix!==void 0?e.prefix:"[OPTIMIZELY]"}return t.prototype.log=function(e,r){if(!(!this.shouldLog(e)||!this.logToConsole)){var i=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+r;this.consoleLog(e,[i])}},t.prototype.setLogLevel=function(e){e=Jt(e),!tt.isValidEnum(P.LogLevel,e)||e===void 0?this.logLevel=P.LogLevel.ERROR:this.logLevel=e},t.prototype.getTime=function(){return new Date().toISOString()},t.prototype.shouldLog=function(e){return e>=this.logLevel},t.prototype.getLogLevelName=function(e){switch(e){case P.LogLevel.DEBUG:return"DEBUG";case P.LogLevel.INFO:return"INFO ";case P.LogLevel.WARNING:return"WARN ";case P.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},t.prototype.consoleLog=function(e,r){switch(e){case P.LogLevel.DEBUG:console.log.apply(console,r);break;case P.LogLevel.INFO:console.info.apply(console,r);break;case P.LogLevel.WARNING:console.warn.apply(console,r);break;case P.LogLevel.ERROR:console.error.apply(console,r);break;default:console.log.apply(console,r)}},t}();$.ConsoleLogHandler=Cs;var xe=P.LogLevel.NOTSET,Xt=null,Ni=function(){function t(e){e===void 0&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return t.prototype.log=function(e,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this.internalLog(Jt(e),{message:r,splat:i})},t.prototype.info=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(P.LogLevel.INFO,e,r)},t.prototype.debug=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(P.LogLevel.DEBUG,e,r)},t.prototype.warn=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(P.LogLevel.WARNING,e,r)},t.prototype.error=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(P.LogLevel.ERROR,e,r)},t.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+tt.sprintf.apply(void 0,Ds([e.message],e.splat))},t.prototype.internalLog=function(e,r){!Xt||e<xe||(Xt.log(e,this.format(r)),r.error&&r.error instanceof Error&&Ls.getErrorHandler().handleError(r.error))},t.prototype.namedLog=function(e,r,i){var n;if(r instanceof Error){n=r,r=n.message,this.internalLog(e,{error:n,message:r,splat:i});return}if(i.length===0){this.internalLog(e,{message:r,splat:i});return}var o=i[i.length-1];o instanceof Error&&(n=o,i.splice(-1)),this.internalLog(e,{message:r,error:n,splat:i})},t}(),bi=new Ai;function Ps(t){return bi.getLogger(t)}$.getLogger=Ps;function ws(t){Xt=t}$.setLogHandler=ws;function Vs(t){t=Jt(t),!tt.isValidEnum(P.LogLevel,t)||t===void 0?xe=P.LogLevel.ERROR:xe=t}$.setLogLevel=Vs;function Fs(){return xe}$.getLogLevel=Fs;function xs(){bi=new Ai,xe=P.LogLevel.NOTSET}$.resetLogger=xs});var ee=A(rt=>{"use strict";function Zt(t){for(var e in t)rt.hasOwnProperty(e)||(rt[e]=t[e])}Object.defineProperty(rt,"__esModule",{value:!0});Zt(xt());Zt(Mt());Zt(Ui())});var Qt=A(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.areEventContextsEqual=void 0;function Ms(t,e){var r=t.context,i=e.context;return r.accountId===i.accountId&&r.projectId===i.projectId&&r.clientName===i.clientName&&r.clientVersion===i.clientVersion&&r.revision===i.revision&&r.anonymizeIP===i.anonymizeIP&&r.botFiltering===i.botFiltering}it.areEventContextsEqual=Ms});var Si=A(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.DefaultEventQueue=Te.SingleEventQueue=void 0;var ks=ee(),Gs=ks.getLogger("EventProcessor"),Ks=function(){function t(e){var r=e.timeout,i=e.callback;this.timeout=Math.max(r,0),this.callback=i}return t.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},t.prototype.refresh=function(){this.stop(),this.start()},t.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},t}(),Bs=function(){function t(e){var r=e.sink;this.sink=r}return t.prototype.start=function(){},t.prototype.stop=function(){return Promise.resolve()},t.prototype.enqueue=function(e){this.sink([e])},t}();Te.SingleEventQueue=Bs;var js=function(){function t(e){var r=e.flushInterval,i=e.maxQueueSize,n=e.sink,o=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(i,1),this.sink=n,this.batchComparator=o,this.timer=new Ks({callback:this.flush.bind(this),timeout:r}),this.started=!1}return t.prototype.start=function(){this.started=!0},t.prototype.stop=function(){this.started=!1;var e=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},t.prototype.enqueue=function(e){if(!this.started){Gs.warn("Queue is stopped, not accepting event");return}var r=this.buffer[0];r&&!this.batchComparator(r,e)&&this.flush(),this.buffer.length===0&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()},t.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},t}();Te.DefaultEventQueue=js});var $t=A(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.sendEventNotification=F.getQueue=F.validateAndGetBatchSize=F.validateAndGetFlushInterval=F.DEFAULT_BATCH_SIZE=F.DEFAULT_FLUSH_INTERVAL=void 0;var Di=Si(),zs=ee(),Hs=Re();F.DEFAULT_FLUSH_INTERVAL=3e4;F.DEFAULT_BATCH_SIZE=10;var Li=zs.getLogger("EventProcessor");function qs(t){return t<=0&&(Li.warn("Invalid flushInterval "+t+", defaulting to "+F.DEFAULT_FLUSH_INTERVAL),t=F.DEFAULT_FLUSH_INTERVAL),t}F.validateAndGetFlushInterval=qs;function Ys(t){return t=Math.floor(t),t<1&&(Li.warn("Invalid batchSize "+t+", defaulting to "+F.DEFAULT_BATCH_SIZE),t=F.DEFAULT_BATCH_SIZE),t=Math.max(1,t),t}F.validateAndGetBatchSize=Ys;function Ws(t,e,r,i){var n;return t>1?n=new Di.DefaultEventQueue({flushInterval:e,maxQueueSize:t,sink:r,batchComparator:i}):n=new Di.SingleEventQueue({sink:r}),n}F.getQueue=Ws;function Xs(t,e){t&&t.sendNotifications(Hs.NOTIFICATION_TYPES.LOG_EVENT,e)}F.sendEventNotification=Xs});var Pi=A(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0})});var Vi=A(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0})});var xi=A(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.LocalStorageStore=void 0;var Js=Re(),Zs=ee(),Fi=Zs.getLogger("EventProcessor"),Qs=function(){function t(e){var r=e.key,i=e.maxValues,n=i===void 0?1e3:i;this.LS_KEY=r,this.maxValues=n}return t.prototype.get=function(e){return this.getMap()[e]||null},t.prototype.set=function(e,r){var i=this.getMap();i[e]=r,this.replace(i)},t.prototype.remove=function(e){var r=this.getMap();delete r[e],this.replace(r)},t.prototype.values=function(){return Js.objectValues(this.getMap())},t.prototype.clear=function(){this.replace({})},t.prototype.replace=function(e){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(r){Fi.error(r)}},t.prototype.clean=function(){var e=this.getMap(),r=Object.keys(e),i=r.length-this.maxValues;if(!(i<1)){var n=r.map(function(a){return{key:a,value:e[a]}});n.sort(function(a,u){return a.value.timestamp-u.value.timestamp});for(var o=0;o<i;o++)delete e[n[o].key];this.replace(e)}},t.prototype.getMap=function(){try{var e=window.localStorage&&localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(r){Fi.error(r)}return{}},t}();nt.LocalStorageStore=Qs});var Gi=A(se=>{"use strict";var $s=se&&se.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(se,"__esModule",{value:!0});se.LocalStoragePendingEventsDispatcher=se.PendingEventsDispatcher=void 0;var eu=ee(),tu=xi(),Mi=Re(),ru=eu.getLogger("EventProcessor"),ki=function(){function t(e){var r=e.eventDispatcher,i=e.store;this.dispatcher=r,this.store=i}return t.prototype.dispatchEvent=function(e,r){this.send({uuid:Mi.generateUUID(),timestamp:Mi.getTimestamp(),request:e},r)},t.prototype.sendPendingEvents=function(){var e=this,r=this.store.values();ru.debug("Sending %s pending events from previous page",r.length),r.forEach(function(i){try{e.send(i,function(){})}catch{}})},t.prototype.send=function(e,r){var i=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,function(n){i.store.remove(e.uuid),r(n)})},t}();se.PendingEventsDispatcher=ki;var iu=function(t){$s(e,t);function e(r){var i=r.eventDispatcher;return t.call(this,{eventDispatcher:i,store:new tu.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return e}(ki);se.LocalStoragePendingEventsDispatcher=iu});var rr=A(Y=>{"use strict";var er=Y&&Y.__assign||function(){return er=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},er.apply(this,arguments)};Object.defineProperty(Y,"__esModule",{value:!0});Y.formatEvents=Y.buildConversionEventV1=Y.buildImpressionEventV1=Y.makeBatchedEventV1=void 0;var nu="campaign_activated",ou="custom",Ki="$opt_bot_filtering";function Bi(t){var e=[],r=t[0];return t.forEach(function(i){if(i.type==="conversion"||i.type==="impression"){var n=tr(i);i.type==="impression"?n.snapshots.push(zi(i)):i.type==="conversion"&&n.snapshots.push(ji(i)),e.push(n)}}),{client_name:r.context.clientName,client_version:r.context.clientVersion,account_id:r.context.accountId,project_id:r.context.projectId,revision:r.context.revision,anonymize_ip:r.context.anonymizeIP,enrich_decisions:!0,visitors:e}}Y.makeBatchedEventV1=Bi;function ji(t){var e=er({},t.tags);delete e.revenue,delete e.value;var r={entity_id:t.event.id,key:t.event.key,timestamp:t.timestamp,uuid:t.uuid};return t.tags&&(r.tags=t.tags),t.value!=null&&(r.value=t.value),t.revenue!=null&&(r.revenue=t.revenue),{events:[r]}}function zi(t){var e,r,i=t.layer,n=t.experiment,o=t.variation,a=t.ruleKey,u=t.flagKey,s=t.ruleType,l=t.enabled,c=i?i.id:null,f=(e=n?.id)!==null&&e!==void 0?e:"",E=(r=o?.id)!==null&&r!==void 0?r:"",v=o?o.key:"";return{decisions:[{campaign_id:c,experiment_id:f,variation_id:E,metadata:{flag_key:u,rule_key:a,rule_type:s,variation_key:v,enabled:l}}],events:[{entity_id:c,timestamp:t.timestamp,key:nu,uuid:t.uuid}]}}function tr(t){var e={snapshots:[],visitor_id:t.user.id,attributes:[]};return t.user.attributes.forEach(function(r){e.attributes.push({entity_id:r.entityId,key:r.key,type:"custom",value:r.value})}),typeof t.context.botFiltering=="boolean"&&e.attributes.push({entity_id:Ki,key:Ki,type:ou,value:t.context.botFiltering}),e}function au(t){var e=tr(t);return e.snapshots.push(zi(t)),{client_name:t.context.clientName,client_version:t.context.clientVersion,account_id:t.context.accountId,project_id:t.context.projectId,revision:t.context.revision,anonymize_ip:t.context.anonymizeIP,enrich_decisions:!0,visitors:[e]}}Y.buildImpressionEventV1=au;function su(t){var e=tr(t);return e.snapshots.push(ji(t)),{client_name:t.context.clientName,client_version:t.context.clientVersion,account_id:t.context.accountId,project_id:t.context.projectId,revision:t.context.revision,anonymize_ip:t.context.anonymizeIP,enrich_decisions:!0,visitors:[e]}}Y.buildConversionEventV1=su;function uu(t){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:Bi(t)}}Y.formatEvents=uu});var Hi=A(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});var lu=function(){function t(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return t.prototype.trackRequest=function(e){var r=this;this.reqsInFlightCount++;var i=function(){r.reqsInFlightCount--,r.reqsInFlightCount===0&&(r.reqsCompleteResolvers.forEach(function(n){return n()}),r.reqsCompleteResolvers=[])};e.then(i,i)},t.prototype.onRequestsComplete=function(){var e=this;return new Promise(function(r){e.reqsInFlightCount===0?r():e.reqsCompleteResolvers.push(r)})},t}();ir.default=lu});var Yi=A(te=>{"use strict";var cu=te&&te.__awaiter||function(t,e,r,i){function n(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function u(c){try{l(i.next(c))}catch(f){a(f)}}function s(c){try{l(i.throw(c))}catch(f){a(f)}}function l(c){c.done?o(c.value):n(c.value).then(u,s)}l((i=i.apply(t,e||[])).next())})},fu=te&&te.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(c){return s([l,c])}}function s(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(o=l[0]&2?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(c){l=[6,c],n=0}finally{i=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},du=te&&te.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(te,"__esModule",{value:!0});te.LogTierV1EventProcessor=void 0;var pu=ee(),Ne=$t(),Eu=du(Hi()),gu=Qt(),vu=rr(),qi=pu.getLogger("LogTierV1EventProcessor"),_u=function(){function t(e){var r=e.dispatcher,i=e.flushInterval,n=i===void 0?Ne.DEFAULT_FLUSH_INTERVAL:i,o=e.batchSize,a=o===void 0?Ne.DEFAULT_BATCH_SIZE:o,u=e.notificationCenter;this.dispatcher=r,this.notificationCenter=u,this.requestTracker=new Eu.default,n=Ne.validateAndGetFlushInterval(n),a=Ne.validateAndGetBatchSize(a),this.queue=Ne.getQueue(a,n,this.drainQueue.bind(this),gu.areEventContextsEqual)}return t.prototype.drainQueue=function(e){var r=this,i=new Promise(function(n){if(qi.debug("draining queue with %s events",e.length),e.length===0){n();return}var o=vu.formatEvents(e);r.dispatcher.dispatchEvent(o,function(){n()}),Ne.sendEventNotification(r.notificationCenter,o)});return this.requestTracker.trackRequest(i),i},t.prototype.process=function(e){this.queue.enqueue(e)},t.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){qi.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},t.prototype.start=function(){return cu(this,void 0,void 0,function(){return fu(this,function(e){return this.queue.start(),[2]})})},t}();te.LogTierV1EventProcessor=_u});var Wi=A(z=>{"use strict";var hu=z&&z.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),pe=z&&z.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hu(e,t,r)};Object.defineProperty(z,"__esModule",{value:!0});pe(Qt(),z);pe($t(),z);pe(Pi(),z);pe(Vi(),z);pe(Gi(),z);pe(rr(),z);pe(Yi(),z)});var Xi=A((Pf,nr)=>{(function(){var t=this;function e(o,a){for(var u=o.length,s=a^u,l=0,c;u>=4;)c=o.charCodeAt(l)&255|(o.charCodeAt(++l)&255)<<8|(o.charCodeAt(++l)&255)<<16|(o.charCodeAt(++l)&255)<<24,c=(c&65535)*1540483477+(((c>>>16)*1540483477&65535)<<16),c^=c>>>24,c=(c&65535)*1540483477+(((c>>>16)*1540483477&65535)<<16),s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16)^c,u-=4,++l;switch(u){case 3:s^=(o.charCodeAt(l+2)&255)<<16;case 2:s^=(o.charCodeAt(l+1)&255)<<8;case 1:s^=o.charCodeAt(l)&255,s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16)}return s^=s>>>13,s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16),s^=s>>>15,s>>>0}function r(o,a){var u,s,l,c,f,E,v,R,_,g;for(u=o.length&3,s=o.length-u,l=a,f=3432918353,v=461845907,g=0;g<s;)_=o.charCodeAt(g)&255|(o.charCodeAt(++g)&255)<<8|(o.charCodeAt(++g)&255)<<16|(o.charCodeAt(++g)&255)<<24,++g,_=(_&65535)*f+(((_>>>16)*f&65535)<<16)&4294967295,_=_<<15|_>>>17,_=(_&65535)*v+(((_>>>16)*v&65535)<<16)&4294967295,l^=_,l=l<<13|l>>>19,c=(l&65535)*5+(((l>>>16)*5&65535)<<16)&4294967295,l=(c&65535)+27492+(((c>>>16)+58964&65535)<<16);switch(_=0,u){case 3:_^=(o.charCodeAt(g+2)&255)<<16;case 2:_^=(o.charCodeAt(g+1)&255)<<8;case 1:_^=o.charCodeAt(g)&255,_=(_&65535)*f+(((_>>>16)*f&65535)<<16)&4294967295,_=_<<15|_>>>17,_=(_&65535)*v+(((_>>>16)*v&65535)<<16)&4294967295,l^=_}return l^=o.length,l^=l>>>16,l=(l&65535)*2246822507+(((l>>>16)*2246822507&65535)<<16)&4294967295,l^=l>>>13,l=(l&65535)*3266489909+(((l>>>16)*3266489909&65535)<<16)&4294967295,l^=l>>>16,l>>>0}var i=r;if(i.v2=e,i.v3=r,typeof nr<"u")nr.exports=i;else{var n=t.murmur;i.noConflict=function(){return t.murmur=n,i},t.murmur=i}})()});var ot=A(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.DEFAULT_UPDATE_INTERVAL=5*60*1e3;ue.MIN_UPDATE_INTERVAL=1e3;ue.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json";ue.DEFAULT_AUTHENTICATED_URL_TEMPLATE="https://config.optimizely.com/datafiles/auth/%s.json";ue.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512];ue.REQUEST_TIMEOUT_MS=60*1e3});var Ji=A(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});var Iu=ot(),yu=ee(),mu=yu.getLogger("DatafileManager"),Ou="GET",Ru=4;function Tu(t){var e=t.getAllResponseHeaders();if(e===null)return{};var r=e.split(`\r
`),i={};return r.forEach(function(n){var o=n.indexOf(": ");if(o>-1){var a=n.slice(0,o),u=n.slice(o+2);u.length>0&&(i[a]=u)}}),i}function Nu(t,e){Object.keys(t).forEach(function(r){var i=t[r];e.setRequestHeader(r,i)})}function Au(t,e){var r=new XMLHttpRequest,i=new Promise(function(n,o){r.open(Ou,t,!0),Nu(e,r),r.onreadystatechange=function(){if(r.readyState===Ru){var a=r.status;if(a===0){o(new Error("Request error"));return}var u=Tu(r),s={statusCode:r.status,body:r.responseText,headers:u};n(s)}},r.timeout=Iu.REQUEST_TIMEOUT_MS,r.ontimeout=function(){mu.error("Request timed out")},r.send()});return{responsePromise:i,abort:function(){r.abort()}}}or.makeGetRequest=Au});var Zi=A(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});var bu=function(){function t(){this.listeners={},this.listenerId=1}return t.prototype.on=function(e,r){var i=this;this.listeners[e]||(this.listeners[e]={});var n=String(this.listenerId);return this.listenerId++,this.listeners[e][n]=r,function(){i.listeners[e]&&delete i.listeners[e][n]}},t.prototype.emit=function(e,r){var i=this.listeners[e];i&&Object.keys(i).forEach(function(n){var o=i[n];o(r)})},t.prototype.removeAllListeners=function(){this.listeners={}},t}();ar.default=bu});var Qi=A(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});var sr=ot();function Uu(){return Math.round(Math.random()*1e3)}var Su=function(){function t(){this.errorCount=0}return t.prototype.getDelay=function(){if(this.errorCount===0)return 0;var e=sr.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(sr.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)];return e*1e3+Uu()},t.prototype.countError=function(){this.errorCount<sr.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},t.prototype.reset=function(){this.errorCount=0},t}();ur.default=Su});var tn=A(Ee=>{"use strict";var at=Ee&&Ee.__assign||function(){return at=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},at.apply(this,arguments)},en=Ee&&Ee.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ee,"__esModule",{value:!0});var Du=ee(),Lu=Re(),Cu=en(Zi()),Me=ot(),Pu=en(Qi()),W=Du.getLogger("DatafileManager"),wu="update";function Vu(t){return t>=Me.MIN_UPDATE_INTERVAL}function $i(t){return t>=200&&t<400}var Fu={get:function(){return Promise.resolve("")},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},xu=function(){function t(e){var r=this,i=at(at({},this.getConfigDefaults()),e),n=i.datafile,o=i.autoUpdate,a=o===void 0?!1:o,u=i.sdkKey,s=i.updateInterval,l=s===void 0?Me.DEFAULT_UPDATE_INTERVAL:s,c=i.urlTemplate,f=c===void 0?Me.DEFAULT_URL_TEMPLATE:c,E=i.cache,v=E===void 0?Fu:E;this.cache=v,this.cacheKey="opt-datafile-"+u,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(R,_){r.readyPromiseResolver=R,r.readyPromiseRejecter=_}),n?(this.currentDatafile=n,u||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=Lu.sprintf(f,u),this.emitter=new Cu.default,this.autoUpdate=a,Vu(l)?this.updateInterval=l:(W.warn("Invalid updateInterval %s, defaulting to %s",l,Me.DEFAULT_UPDATE_INTERVAL),this.updateInterval=Me.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new Pu.default,this.syncOnCurrentRequestComplete=!1}return t.prototype.get=function(){return this.currentDatafile},t.prototype.start=function(){this.isStarted||(W.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},t.prototype.stop=function(){return W.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},t.prototype.onReady=function(){return this.readyPromise},t.prototype.on=function(e,r){return this.emitter.on(e,r)},t.prototype.onRequestRejected=function(e){!this.isStarted||(this.backoffController.countError(),e instanceof Error?W.error("Error fetching datafile: %s",e.message,e):typeof e=="string"?W.error("Error fetching datafile: %s",e):W.error("Error fetching datafile"))},t.prototype.onRequestResolved=function(e){if(!!this.isStarted){typeof e.statusCode<"u"&&$i(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var r=this.getNextDatafileFromResponse(e);if(r!=="")if(W.info("Updating datafile from response"),this.currentDatafile=r,this.cache.set(this.cacheKey,r),!this.isReadyPromiseSettled)this.resolveReadyPromise();else{var i={datafile:r};this.emitter.emit(wu,i)}}},t.prototype.onRequestComplete=function(){!this.isStarted||(this.currentRequest=null,!this.isReadyPromiseSettled&&!this.autoUpdate&&this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},t.prototype.syncDatafile=function(){var e=this,r={};this.lastResponseLastModified&&(r["if-modified-since"]=this.lastResponseLastModified),W.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(r)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,r);var i=function(){e.onRequestComplete()},n=function(a){e.onRequestResolved(a)},o=function(a){e.onRequestRejected(a)};this.currentRequest.responsePromise.then(n,o).then(i,i),this.autoUpdate&&this.scheduleNextUpdate()},t.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},t.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},t.prototype.scheduleNextUpdate=function(){var e=this,r=this.backoffController.getDelay(),i=Math.max(r,this.updateInterval);W.debug("Scheduling sync in %s ms",i),this.currentTimeout=setTimeout(function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()},i)},t.prototype.getNextDatafileFromResponse=function(e){return W.debug("Response status code: %s",e.statusCode),typeof e.statusCode>"u"||e.statusCode===304?"":$i(e.statusCode)?e.body:""},t.prototype.trySavingLastModified=function(e){var r=e["last-modified"]||e["Last-Modified"];typeof r<"u"&&(this.lastResponseLastModified=r,W.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},t.prototype.setDatafileFromCacheIfAvailable=function(){var e=this;this.cache.get(this.cacheKey).then(function(r){e.isStarted&&!e.isReadyPromiseSettled&&r!==""&&(W.debug("Using datafile from cache"),e.currentDatafile=r,e.resolveReadyPromise())})},t}();Ee.default=xu});var rn=A(ge=>{"use strict";var Mu=ge&&ge.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o])},t(e,r)};return function(e,r){t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}(),ku=ge&&ge.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ge,"__esModule",{value:!0});var Gu=Ji(),Ku=ku(tn()),Bu=function(t){Mu(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.makeGetRequest=function(r,i){return Gu.makeGetRequest(r,i)},e.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},e}(Ku.default);ge.default=Bu});var nn=A(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});var ju=rn();lr.HttpPollingDatafileManager=ju.default});var be=A(C=>{"use strict";function vn(t){return t&&typeof t=="object"&&"default"in t?t.default:t}Object.defineProperty(C,"__esModule",{value:!0});var w=ee(),dt=Wi(),zu=vn(Wt()),Hu=vn(Xi()),qu=nn(),he=function(){return(he=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function Ir(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,n++)i[n]=o[a];return i}var Yu=Math.pow(2,53);function X(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!t)return{};if(typeof Object.assign=="function")return Object.assign.apply(Object,Ir([t],e));for(var i=Object(t),n=0;n<e.length;n++){var o=e[n];if(o!=null)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i[a]=o[a])}return i}function K(t,e){return t?hn(t,function(r){return r[e]}):{}}function ne(t){return Object.keys(t).map(function(e){return t[e]})}function _n(t){return Object.keys(t).map(function(e){return[e,t[e]]})}function yr(t,e){for(var r,i=0,n=t;i<n.length;i++){var o=n[i];if(e(o)){r=o;break}}return r}function hn(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=i}),r}function b(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=0;return t.replace(/%s/g,function(){var n=e[i++],o=typeof n;return o==="function"?n():o==="string"?n:String(n)})}var B,U={assign:X,currentTimestamp:function(){return Math.round(new Date().getTime())},isSafeInteger:function(t){return typeof t=="number"&&Math.abs(t)<=Yu},keyBy:K,uuid:function(){return zu()},isNumber:function(t){return typeof t=="number"},getTimestamp:function(){return new Date().getTime()},isValidEnum:function(t,e){for(var r=!1,i=Object.keys(t),n=0;n<i.length;n++)if(e===t[i[n]]){r=!0;break}return r},groupBy:function(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=r[n]||[],r[n].push(i)}),ne(r)},objectValues:ne,objectEntries:_n,find:yr,keyByUtil:hn,sprintf:b},d={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},m={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},p={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_DEFAULT_DECIDE_OPTIONS:"%s: Provided default decide options is not an array.",INVALID_DECIDE_OPTIONS:"%s: Provided decide options is not an array. Using default decide options.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",UNRECOGNIZED_DECIDE_OPTION:"%s: Unrecognized decide option %s provided.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},re={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent",FORCED_DECISION_NULL_RULE_KEY:"$opt_null_rule_key"},ve={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables",FLAG:"flag"},x={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},Er={RULE:"rule",EXPERIMENT:"experiment"},q={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},pt={V2:"2",V3:"3",V4:"4"},gr={SDK_NOT_READY:"Optimizely SDK not configured properly yet.",FLAG_KEY_INVALID:'No flag was found for key "%s".',VARIABLE_VALUE_INVALID:'Variable value for key "%s" is invalid or wrong type.'};(function(t){t.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",t.DECISION="DECISION:type, userId, attributes, decisionInfo",t.LOG_EVENT="LOG_EVENT:logEvent",t.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",t.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"})(B||(B={}));var In=Object.freeze({__proto__:null,LOG_LEVEL:d,ERROR_MESSAGES:m,LOG_MESSAGES:p,CONTROL_ATTRIBUTES:re,JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",REACT_NATIVE_CLIENT_ENGINE:"react-native-sdk",REACT_NATIVE_JS_CLIENT_ENGINE:"react-native-js-sdk",NODE_CLIENT_VERSION:"4.9.2",DECISION_NOTIFICATION_TYPES:ve,DECISION_SOURCES:x,AUDIENCE_EVALUATION_TYPES:Er,FEATURE_VARIABLE_TYPES:q,DATAFILE_VERSIONS:pt,DECISION_MESSAGES:gr,get NOTIFICATION_TYPES(){return B}}),_e="CONFIG_VALIDATOR",Wu=[pt.V2,pt.V3,pt.V4],Xu=function(t){if(typeof t=="object"&&t!==null){var e=t,r=e.errorHandler,i=e.eventDispatcher,n=e.logger;if(r&&typeof r.handleError!="function")throw new Error(b(m.INVALID_ERROR_HANDLER,_e));if(i&&typeof i.dispatchEvent!="function")throw new Error(b(m.INVALID_EVENT_DISPATCHER,_e));if(n&&typeof n.log!="function")throw new Error(b(m.INVALID_LOGGER,_e));return!0}throw new Error(b(m.INVALID_CONFIG,_e))},Ju=function(t){if(!t)throw new Error(b(m.NO_DATAFILE_SPECIFIED,_e));if(typeof t=="string")try{t=JSON.parse(t)}catch{throw new Error(b(m.INVALID_DATAFILE_MALFORMED,_e))}if(typeof t=="object"&&!Array.isArray(t)&&t!==null&&Wu.indexOf(t.version)===-1)throw new Error(b(m.INVALID_DATAFILE_VERSION,_e,t.version));return t},yn={handleError:function(){}},Zu=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},mr={dispatchEvent:function(t,e){var r,i=t.params,n=t.url;t.httpVerb==="POST"?((r=new XMLHttpRequest).open("POST",n,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(r.readyState===4&&e&&typeof e=="function")try{e({statusCode:r.status})}catch{}},r.send(JSON.stringify(i))):(n+="?wxhr=true",i&&(n+="&"+Zu(i)),(r=new XMLHttpRequest).open("GET",n,!0),r.onreadystatechange=function(){if(r.readyState===4&&e&&typeof e=="function")try{e({statusCode:r.status})}catch{}},r.send())}},on=function(){function t(){}return t.prototype.log=function(){},t}();function mn(t){return new w.ConsoleLogHandler(t)}var an,ke,On=Object.freeze({__proto__:null,NoOpLogger:on,createLogger:mn,createNoOpLogger:function(){return new on}});function sn(t,e,r){return{variationKey:null,enabled:!1,variables:{},ruleKey:null,flagKey:t,userContext:e,reasons:r}}(function(t){t.BOOLEAN="boolean",t.DOUBLE="double",t.INTEGER="integer",t.STRING="string",t.JSON="json"})(an||(an={})),(ke=C.OptimizelyDecideOption||(C.OptimizelyDecideOption={})).DISABLE_DECISION_EVENT="DISABLE_DECISION_EVENT",ke.ENABLED_FLAGS_ONLY="ENABLED_FLAGS_ONLY",ke.IGNORE_USER_PROFILE_SERVICE="IGNORE_USER_PROFILE_SERVICE",ke.INCLUDE_REASONS="INCLUDE_REASONS",ke.EXCLUDE_VARIABLES="EXCLUDE_VARIABLES";var Qu=function(){function t(e){var r,i=e.optimizely,n=e.userId,o=e.attributes;this.optimizely=i,this.userId=n,this.attributes=(r=he({},o))!==null&&r!==void 0?r:{},this.forcedDecisionsMap={}}return t.prototype.setAttribute=function(e,r){this.attributes[e]=r},t.prototype.getUserId=function(){return this.userId},t.prototype.getAttributes=function(){return he({},this.attributes)},t.prototype.getOptimizely=function(){return this.optimizely},t.prototype.decide=function(e,r){return r===void 0&&(r=[]),this.optimizely.decide(this.cloneUserContext(),e,r)},t.prototype.decideForKeys=function(e,r){return r===void 0&&(r=[]),this.optimizely.decideForKeys(this.cloneUserContext(),e,r)},t.prototype.decideAll=function(e){return e===void 0&&(e=[]),this.optimizely.decideAll(this.cloneUserContext(),e)},t.prototype.trackEvent=function(e,r){this.optimizely.track(e,this.userId,this.attributes,r)},t.prototype.setForcedDecision=function(e,r){var i,n=e.flagKey,o=(i=e.ruleKey)!==null&&i!==void 0?i:re.FORCED_DECISION_NULL_RULE_KEY,a={variationKey:r.variationKey};return this.forcedDecisionsMap[n]||(this.forcedDecisionsMap[n]={}),this.forcedDecisionsMap[n][o]=a,!0},t.prototype.getForcedDecision=function(e){return this.findForcedDecision(e)},t.prototype.removeForcedDecision=function(e){var r,i=(r=e.ruleKey)!==null&&r!==void 0?r:re.FORCED_DECISION_NULL_RULE_KEY,n=e.flagKey,o=!1;return this.forcedDecisionsMap.hasOwnProperty(n)&&(this.forcedDecisionsMap[n].hasOwnProperty(i)&&(delete this.forcedDecisionsMap[n][i],o=!0),Object.keys(this.forcedDecisionsMap[n]).length===0&&delete this.forcedDecisionsMap[n]),o},t.prototype.removeAllForcedDecisions=function(){return this.forcedDecisionsMap={},!0},t.prototype.findForcedDecision=function(e){var r,i=(r=e.ruleKey)!==null&&r!==void 0?r:re.FORCED_DECISION_NULL_RULE_KEY,n=e.flagKey;if(this.forcedDecisionsMap.hasOwnProperty(e.flagKey)){var o=this.forcedDecisionsMap[n];if(o.hasOwnProperty(i))return{variationKey:o[i].variationKey}}return null},t.prototype.cloneUserContext=function(){var e=new t({optimizely:this.getOptimizely(),userId:this.getUserId(),attributes:this.getAttributes()});return Object.keys(this.forcedDecisionsMap).length>0&&(e.forcedDecisionsMap=he({},this.forcedDecisionsMap)),e},t}(),Rn=["and","or","not"];function Ke(t,e){if(Array.isArray(t)){var r=t[0],i=t.slice(1);switch(typeof r=="string"&&Rn.indexOf(r)===-1&&(r="or",i=t),r){case"and":return function(n,o){var a=!1;if(Array.isArray(n)){for(var u=0;u<n.length;u++){var s=Ke(n[u],o);if(s===!1)return!1;s===null&&(a=!0)}return!a||null}return null}(i,e);case"not":return function(n,o){if(Array.isArray(n)&&n.length>0){var a=Ke(n[0],o);return a===null?null:!a}return null}(i,e);default:return function(n,o){var a=!1;if(Array.isArray(n)){for(var u=0;u<n.length;u++){var s=Ke(n[u],o);if(s===!0)return!0;s===null&&(a=!0)}return!!a&&null}return null}(i,e)}}return e(t)}var $u=function(){function t(e,r){var i,n;this.sdkKey=(i=e.sdkKey)!==null&&i!==void 0?i:"",this.environmentKey=(n=e.environmentKey)!==null&&n!==void 0?n:"",this.attributes=e.attributes,this.audiences=t.getAudiences(e),this.events=e.events,this.revision=e.revision;var o=(e.featureFlags||[]).reduce(function(u,s){return u[s.id]=s.variables,u},{}),a=t.getExperimentsMapById(e,o);this.experimentsMap=t.getExperimentsKeyMap(a),this.featuresMap=t.getFeaturesMap(e,o,a),this.datafile=r}return t.prototype.getDatafile=function(){return this.datafile},t.getAudiences=function(e){var r=[],i=[];return(e.typedAudiences||[]).forEach(function(n){r.push({id:n.id,conditions:JSON.stringify(n.conditions),name:n.name}),i.push(n.id)}),(e.audiences||[]).forEach(function(n){i.indexOf(n.id)===-1&&n.id!="$opt_dummy_audience"&&r.push({id:n.id,conditions:JSON.stringify(n.conditions),name:n.name})}),r},t.getSerializedAudiences=function(e,r){var i="";if(e){var n="";e.forEach(function(o){var a="";if(o instanceof Array)a="("+(a=t.getSerializedAudiences(o,r))+")";else if(Rn.indexOf(o)>-1)n=o.toUpperCase();else{var u=r[o]?r[o].name:o;i||n==="NOT"?(n=n===""?"OR":n,i=i===""?n+' "'+r[o].name+'"':i.concat(" "+n+' "'+u+'"')):i='"'+u+'"'}a!==""&&(i!==""||n==="NOT"?(n=n===""?"OR":n,i=i===""?n+" "+a:i.concat(" "+n+" "+a)):i=i.concat(a))})}return i},t.getExperimentAudiences=function(e,r){return e.audienceConditions?t.getSerializedAudiences(e.audienceConditions,r.audiencesById):""},t.mergeFeatureVariables=function(e,r,i,n,o){var a=(e[i]||[]).reduce(function(u,s){return u[s.key]={id:s.id,key:s.key,type:s.type,value:s.defaultValue},u},{});return(n||[]).forEach(function(u){var s=r[u.id],l={id:u.id,key:s.key,type:s.type,value:o?u.value:s.defaultValue};a[s.key]=l}),a},t.getVariationsMap=function(e,r,i,n){return e.reduce(function(o,a){var u=t.mergeFeatureVariables(r,i,n,a.variables,a.featureEnabled);return o[a.key]={id:a.id,key:a.key,featureEnabled:a.featureEnabled,variablesMap:u},o},{})},t.getVariableIdMap=function(e){return(e.featureFlags||[]).reduce(function(r,i){return i.variables.forEach(function(n){r[n.id]=n}),r},{})},t.getDeliveryRules=function(e,r,i,n){var o=t.getVariableIdMap(e);return n.map(function(a){return{id:a.id,key:a.key,audiences:t.getExperimentAudiences(a,e),variationsMap:t.getVariationsMap(a.variations,r,o,i)}})},t.getRolloutExperimentIds=function(e){var r=[];return(e||[]).forEach(function(i){i.experiments.forEach(function(n){r.push(n.id)})}),r},t.getExperimentsMapById=function(e,r){var i=t.getVariableIdMap(e),n=this.getRolloutExperimentIds(e.rollouts);return(e.experiments||[]).reduce(function(o,a){if(n.indexOf(a.id)===-1){var u=e.experimentFeatureMap[a.id],s="";u&&u.length>0&&(s=u[0]);var l=t.getVariationsMap(a.variations,r,i,s.toString());o[a.id]={id:a.id,key:a.key,audiences:t.getExperimentAudiences(a,e),variationsMap:l}}return o},{})},t.getExperimentsKeyMap=function(e){var r={};for(var i in e){var n=e[i];r[n.key]=n}return r},t.getFeaturesMap=function(e,r,i){var n={};return e.featureFlags.forEach(function(o){var a={},u=[];o.experimentIds.forEach(function(f){var E=i[f];E&&(a[E.key]=E),u.push(i[f])});var s=(o.variables||[]).reduce(function(f,E){return f[E.key]={id:E.id,key:E.key,type:E.type,value:E.defaultValue},f},{}),l=[],c=e.rolloutIdMap[o.rolloutId];c&&(l=t.getDeliveryRules(e,r,o.id,c.experiments)),n[o.key]={id:o.id,key:o.key,experimentRules:u,deliveryRules:l,experimentsMap:a,variablesMap:s}}),n},t}(),M="PROJECT_CONFIG",el=function(t,e){e===void 0&&(e=null);var r,i,n,o,a=((o=X({},r=t)).audiences=(r.audiences||[]).map(function(u){return X({},u)}),o.experiments=(r.experiments||[]).map(function(u){return X({},u)}),o.featureFlags=(r.featureFlags||[]).map(function(u){return X({},u)}),o.groups=(r.groups||[]).map(function(u){var s=X({},u);return s.experiments=(u.experiments||[]).map(function(l){return X({},l)}),s}),o.rollouts=(r.rollouts||[]).map(function(u){var s=X({},u);return s.experiments=(u.experiments||[]).map(function(l){return X({},l)}),s}),o.environmentKey=(i=r.environmentKey)!==null&&i!==void 0?i:"",o.sdkKey=(n=r.sdkKey)!==null&&n!==void 0?n:"",o);return a.__datafileStr=e===null?JSON.stringify(t):e,(a.audiences||[]).forEach(function(u){u.conditions=JSON.parse(u.conditions)}),a.audiencesById=K(a.audiences,"id"),X(a.audiencesById,K(a.typedAudiences,"id")),a.attributeKeyMap=K(a.attributes,"key"),a.eventKeyMap=K(a.events,"key"),a.groupIdMap=K(a.groups,"id"),Object.keys(a.groupIdMap||{}).forEach(function(u){(a.groupIdMap[u].experiments||[]).forEach(function(s){a.experiments.push(X(s,{groupId:u}))})}),a.rolloutIdMap=K(a.rollouts||[],"id"),ne(a.rolloutIdMap||{}).forEach(function(u){(u.experiments||[]).forEach(function(s){a.experiments.push(s),s.variationKeyMap=K(s.variations,"key")})}),a.experimentKeyMap=K(a.experiments,"key"),a.experimentIdMap=K(a.experiments,"id"),a.variationIdMap={},a.variationVariableUsageMap={},(a.experiments||[]).forEach(function(u){u.variationKeyMap=K(u.variations,"key"),X(a.variationIdMap,K(u.variations,"id")),ne(u.variationKeyMap||{}).forEach(function(s){s.variables&&(a.variationVariableUsageMap[s.id]=K(s.variables,"id"))})}),a.experimentFeatureMap={},a.featureKeyMap=K(a.featureFlags||[],"key"),ne(a.featureKeyMap||{}).forEach(function(u){u.variables.forEach(function(s){s.type===q.STRING&&s.subType===q.JSON&&(s.type=q.JSON,delete s.subType)}),u.variableKeyMap=K(u.variables,"key"),(u.experimentIds||[]).forEach(function(s){a.experimentFeatureMap[s]?a.experimentFeatureMap[s].push(u.id):a.experimentFeatureMap[s]=[u.id]})}),a.flagRulesMap={},(a.featureFlags||[]).forEach(function(u){var s=[];u.experimentIds.forEach(function(c){var f=a.experimentIdMap[c];f&&s.push(f)});var l=a.rolloutIdMap[u.rolloutId];l&&s.push.apply(s,l.experiments),a.flagRulesMap[u.key]=s}),a.flagVariationsMap={},_n(a.flagRulesMap||{}).forEach(function(u){var s=u[0],l=u[1],c=[];l.forEach(function(f){f.variations.forEach(function(E){yr(c,function(v){return v.id===E.id})||c.push(E)})}),a.flagVariationsMap[s]=c}),a},Tn=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(b(m.INVALID_EXPERIMENT_ID,M,e));return r.layerId},Nn=function(t,e,r){var i=t.attributeKeyMap[e],n=e.indexOf("$opt_")===0;return i?(n&&r.log(d.WARNING,"Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",e,"$opt_"),i.id):n?e:(r.log(d.DEBUG,m.UNRECOGNIZED_ATTRIBUTE,M,e),null)},An=function(t,e){var r=t.eventKeyMap[e];return r?r.id:null},bn=function(t,e){var r=t.experimentKeyMap[e];if(!r)throw new Error(b(m.INVALID_EXPERIMENT_KEY,M,e));return r.status},Un=function(t,e){return t.variationIdMap.hasOwnProperty(e)?t.variationIdMap[e].key:null},vr=function(t,e){if(t.experimentKeyMap.hasOwnProperty(e)){var r=t.experimentKeyMap[e];if(r)return r}throw new Error(b(m.EXPERIMENT_KEY_NOT_IN_DATAFILE,M,e))},tl=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(b(m.INVALID_EXPERIMENT_ID,M,e));return r.trafficAllocation},rl=function(t,e,r){if(t.experimentIdMap.hasOwnProperty(e)){var i=t.experimentIdMap[e];if(i)return i}return r.log(d.ERROR,m.INVALID_EXPERIMENT_ID,M,e),null},un=function(t,e,r){if(!t)return null;var i=yr(t.flagVariationsMap[e],function(n){return n.key===r});return i||null},cr=function(t,e,r){if(t.featureKeyMap.hasOwnProperty(e)){var i=t.featureKeyMap[e];if(i)return i}return r.log(d.ERROR,m.FEATURE_NOT_IN_DATAFILE,M,e),null},Sn=function(t){return t.__datafileStr},Dn=function(t){var e;try{e=Ju(t.datafile)}catch(i){return{configObj:null,error:i}}if(t.jsonSchemaValidator)try{t.jsonSchemaValidator.validate(e),t.logger.log(d.INFO,p.VALID_DATAFILE,M)}catch(i){return{configObj:null,error:i}}else t.logger.log(d.INFO,p.SKIPPING_JSON_VALIDATION,M);var r=[e];return typeof t.datafile=="string"&&r.push(t.datafile),{configObj:el.apply(void 0,r),error:null}},ln=function(t){return!!t.sendFlagDecisions},st=w.getLogger();function Ae(t,e){return t instanceof Error?t.message:e||"Unknown error"}var il=function(){function t(e){this.updateListeners=[],this.configObj=null,this.optimizelyConfigObj=null,this.datafileManager=null;try{if(this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){var r=new Error(b(m.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.readyPromise=Promise.resolve({success:!1,reason:Ae(r)}),void st.error(r)}var i=null;e.datafile&&(i=this.handleNewDatafile(e.datafile)),e.sdkKey&&e.datafileManager?(this.datafileManager=e.datafileManager,this.datafileManager.start(),this.readyPromise=this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this),this.onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.onDatafileManagerUpdate.bind(this))):this.configObj?this.readyPromise=Promise.resolve({success:!0}):this.readyPromise=Promise.resolve({success:!1,reason:Ae(i,"Invalid datafile")})}catch(n){st.error(n),this.readyPromise=Promise.resolve({success:!1,reason:Ae(n,"Error in initialize")})}}return t.prototype.onDatafileManagerReadyFulfill=function(){if(this.datafileManager){var e=this.handleNewDatafile(this.datafileManager.get());return e?{success:!1,reason:Ae(e)}:{success:!0}}return{success:!1,reason:Ae(null,"Datafile manager is not provided")}},t.prototype.onDatafileManagerReadyReject=function(e){return{success:!1,reason:Ae(e,"Failed to become ready")}},t.prototype.onDatafileManagerUpdate=function(){this.datafileManager&&this.handleNewDatafile(this.datafileManager.get())},t.prototype.handleNewDatafile=function(e){var r=Dn({datafile:e,jsonSchemaValidator:this.jsonSchemaValidator,logger:st}),i=r.configObj,n=r.error;if(n)st.error(n);else{var o=this.configObj?this.configObj.revision:"null";i&&o!==i.revision&&(this.configObj=i,this.optimizelyConfigObj=null,this.updateListeners.forEach(function(a){return a(i)}))}return n},t.prototype.getConfig=function(){return this.configObj},t.prototype.getOptimizelyConfig=function(){var e,r;return!this.optimizelyConfigObj&&this.configObj&&(this.optimizelyConfigObj=(e=this.configObj,r=Sn(this.configObj),new $u(e,r))),this.optimizelyConfigObj},t.prototype.onReady=function(){return this.readyPromise},t.prototype.onUpdate=function(e){var r=this;return this.updateListeners.push(e),function(){var i=r.updateListeners.indexOf(e);i>-1&&r.updateListeners.splice(i,1)}},t.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.updateListeners=[]},t}(),nl=Math.pow(2,32),cn=function(t){var e=[],r=t.experimentIdMap[t.experimentId].groupId;if(r){var i=t.groupIdMap[r];if(!i)throw new Error(b(m.INVALID_GROUP_ID,"BUCKETER",r));if(i.policy==="random"){var n=ol(i,t.bucketingId,t.userId,t.logger);if(n===null)return t.logger.log(d.INFO,p.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r),e.push([p.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r]),{result:null,reasons:e};if(n!==t.experimentId)return t.logger.log(d.INFO,p.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r),e.push([p.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r]),{result:null,reasons:e};t.logger.log(d.INFO,p.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r),e.push([p.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r])}}var o=""+t.bucketingId+t.experimentId,a=Cn(o);t.logger.log(d.DEBUG,p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,t.userId),e.push([p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,t.userId]);var u=Ln(a,t.trafficAllocationConfig);return u===null||t.variationIdMap[u]?{result:u,reasons:e}:(u&&(t.logger.log(d.WARNING,p.INVALID_VARIATION_ID,"BUCKETER"),e.push([p.INVALID_VARIATION_ID,"BUCKETER"])),{result:null,reasons:e})},ol=function(t,e,r,i){var n=""+e+t.id,o=Cn(n);i.log(d.DEBUG,p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",o,r);var a=t.trafficAllocation;return Ln(o,a)},Ln=function(t,e){for(var r=0;r<e.length;r++)if(t<e[r].endOfRange)return e[r].entityId;return null},Cn=function(t){try{var e=Hu.v3(t,1)/nl;return Math.floor(1e4*e)}catch(r){throw new Error(b(m.INVALID_BUCKETING_ID,"BUCKETER",t,r.message))}},ut=w.getLogger();function Pn(t){return/^\d+$/.test(t)}function ce(t){var e=t.indexOf("-"),r=t.indexOf("+");return!(e<0)&&(r<0||e<r)}function wn(t){var e=t.indexOf("-"),r=t.indexOf("+");return!(r<0)&&(e<0||r<e)}function fn(t){var e=t,r="";if(function(u){return/\s/.test(u)}(t))return ut.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;if(ce(t)?(e=t.substring(0,t.indexOf("-")),r=t.substring(t.indexOf("-")+1)):wn(t)&&(e=t.substring(0,t.indexOf("+")),r=t.substring(t.indexOf("+")+1)),typeof e!="string"||typeof r!="string")return null;var i=e.split(".").length-1;if(i>2)return ut.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;var n=e.split(".");if(n.length!=i+1)return ut.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;for(var o=0,a=n;o<a.length;o++)if(!Pn(a[o]))return ut.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;return r&&n.push(r),n}var k="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",G=w.getLogger(),al=["exact","exists","gt","ge","lt","le","substring","semver_eq","semver_lt","semver_le","semver_gt","semver_ge"],H={};function dn(t){return typeof t=="string"||typeof t=="boolean"||U.isNumber(t)}function Vn(t,e){var r=t.value,i=typeof r,n=t.name,o=e[n],a=typeof o;return!dn(r)||U.isNumber(r)&&!U.isSafeInteger(r)?(G.warn(p.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(t)),null):o===null?(G.debug(p.UNEXPECTED_TYPE_NULL,k,JSON.stringify(t),n),null):dn(o)&&i===a?U.isNumber(o)&&!U.isSafeInteger(o)?(G.warn(p.OUT_OF_BOUNDS,k,JSON.stringify(t),n),null):r===o:(G.warn(p.UNEXPECTED_TYPE,k,JSON.stringify(t),a,n),null)}function lt(t,e){var r=t.name,i=e[r],n=typeof i,o=t.value;return o!==null&&U.isSafeInteger(o)?i===null?(G.debug(p.UNEXPECTED_TYPE_NULL,k,JSON.stringify(t),r),!1):U.isNumber(i)?!!U.isSafeInteger(i)||(G.warn(p.OUT_OF_BOUNDS,k,JSON.stringify(t),r),!1):(G.warn(p.UNEXPECTED_TYPE,k,JSON.stringify(t),n,r),!1):(G.warn(p.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(t)),!1)}function Ge(t,e){var r=t.name,i=e[r],n=typeof i,o=t.value;return typeof o!="string"?(G.warn(p.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(t)),null):i===null?(G.debug(p.UNEXPECTED_TYPE_NULL,k,JSON.stringify(t),r),null):typeof i!="string"?(G.warn(p.UNEXPECTED_TYPE,k,JSON.stringify(t),n,r),null):function(a,u){var s=fn(u),l=fn(a);if(!s||!l)return null;for(var c=s.length,f=0;f<l.length;f++){if(c<=f)return ce(a)||wn(a)?1:-1;if(Pn(s[f])){var E=parseInt(s[f]),v=parseInt(l[f]);if(E>v)return 1;if(E<v)return-1}else{if(s[f]<l[f])return ce(a)&&!ce(u)?1:-1;if(s[f]>l[f])return!ce(a)&&ce(u)?-1:1}}return ce(u)&&!ce(a)?-1:0}(o,i)}H.exact=Vn,H.exists=function(t,e){var r=e[t.name];return r!=null},H.gt=function(t,e){var r=e[t.name],i=t.value;return!lt(t,e)||i===null?null:r>i},H.ge=function(t,e){var r=e[t.name],i=t.value;return!lt(t,e)||i===null?null:r>=i},H.lt=function(t,e){var r=e[t.name],i=t.value;return!lt(t,e)||i===null?null:r<i},H.le=function(t,e){var r=e[t.name],i=t.value;return!lt(t,e)||i===null?null:r<=i},H.substring=function(t,e){var r=t.name,i=e[t.name],n=typeof i,o=t.value;return typeof o!="string"?(G.warn(p.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(t)),null):i===null?(G.debug(p.UNEXPECTED_TYPE_NULL,k,JSON.stringify(t),r),null):typeof i!="string"?(G.warn(p.UNEXPECTED_TYPE,k,JSON.stringify(t),n,r),null):i.indexOf(o)!==-1},H.semver_eq=function(t,e){var r=Ge(t,e);return r===null?null:r===0},H.semver_gt=function(t,e){var r=Ge(t,e);return r===null?null:r>0},H.semver_ge=function(t,e){var r=Ge(t,e);return r===null?null:r>=0},H.semver_lt=function(t,e){var r=Ge(t,e);return r===null?null:r<0},H.semver_le=function(t,e){var r=Ge(t,e);return r===null?null:r<=0};var sl=Object.freeze({__proto__:null,evaluate:function(t,e){var r=t.match;if(r!==void 0&&al.indexOf(r)===-1)return G.warn(p.UNKNOWN_MATCH_TYPE,k,JSON.stringify(t)),null;var i=t.name;return e.hasOwnProperty(i)||r=="exists"?(r&&H[r]||Vn)(t,e):(G.debug(p.MISSING_ATTRIBUTE_VALUE,k,JSON.stringify(t),i),null)}}),ct=w.getLogger(),ul=function(){function t(e){this.typeToEvaluatorMap=U.assign({},e,{custom_attribute:sl})}return t.prototype.evaluate=function(e,r,i){var n=this;return i===void 0&&(i={}),!e||e.length===0?!0:!!Ke(e,function(o){var a=r[o];if(a){ct.log(d.DEBUG,p.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",o,JSON.stringify(a.conditions));var u=Ke(a.conditions,n.evaluateConditionWithUserAttributes.bind(n,i)),s=u===null?"UNKNOWN":u.toString().toUpperCase();return ct.log(d.DEBUG,p.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",o,s),u}return null})},t.prototype.evaluateConditionWithUserAttributes=function(e,r){var i=this.typeToEvaluatorMap[r.type];if(!i)return ct.log(d.WARNING,p.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(r)),null;try{return i.evaluate(r,e)}catch(n){ct.log(d.ERROR,m.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",r.type,n.message)}return null},t}();function Fn(t){return typeof t=="string"&&t!==""}var I="DECISION_SERVICE",ll=function(){function t(e){var r;this.audienceEvaluator=(r=e.UNSTABLE_conditionEvaluators,new ul(r)),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}return t.prototype.getVariation=function(e,r,i,n){n===void 0&&(n={});var o=i.getUserId(),a=i.getAttributes(),u=this.getBucketingId(o,a),s=[],l=r.key;if(!this.checkIfExperimentIsActive(e,l))return this.logger.log(d.INFO,p.EXPERIMENT_NOT_RUNNING,I,l),s.push([p.EXPERIMENT_NOT_RUNNING,I,l]),{result:null,reasons:s};var c=this.getForcedVariation(e,l,o);s.push.apply(s,c.reasons);var f=c.result;if(f)return{result:f,reasons:s};var E=this.getWhitelistedVariation(r,o);s.push.apply(s,E.reasons);var v=E.result;if(v)return{result:v.key,reasons:s};var R=n[C.OptimizelyDecideOption.IGNORE_USER_PROFILE_SERVICE],_=this.resolveExperimentBucketMap(o,a);if(!R&&(v=this.getStoredVariation(e,r,o,_)))return this.logger.log(d.INFO,p.RETURNING_STORED_VARIATION,I,v.key,l,o),s.push([p.RETURNING_STORED_VARIATION,I,v.key,l,o]),{result:v.key,reasons:s};var g=this.checkIfUserIsInAudience(e,r,Er.EXPERIMENT,a,"");if(s.push.apply(s,g.reasons),!g.result)return this.logger.log(d.INFO,p.USER_NOT_IN_EXPERIMENT,I,o,l),s.push([p.USER_NOT_IN_EXPERIMENT,I,o,l]),{result:null,reasons:s};var O=this.buildBucketerParams(e,r,u,o),h=cn(O);s.push.apply(s,h.reasons);var N=h.result;return N&&(v=e.variationIdMap[N]),v?(this.logger.log(d.INFO,p.USER_HAS_VARIATION,I,o,v.key,l),s.push([p.USER_HAS_VARIATION,I,o,v.key,l]),R||this.saveUserProfile(r,v,o,_),{result:v.key,reasons:s}):(this.logger.log(d.DEBUG,p.USER_HAS_NO_VARIATION,I,o,l),s.push([p.USER_HAS_NO_VARIATION,I,o,l]),{result:null,reasons:s})},t.prototype.resolveExperimentBucketMap=function(e,r){r=r||{};var i=this.getUserProfile(e)||{},n=r[re.STICKY_BUCKETING_KEY];return U.assign({},i.experiment_bucket_map,n)},t.prototype.checkIfExperimentIsActive=function(e,r){return function(i,n){return bn(i,n)==="Running"}(e,r)},t.prototype.getWhitelistedVariation=function(e,r){var i=[];if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(r)){var n=e.forcedVariations[r];return e.variationKeyMap.hasOwnProperty(n)?(this.logger.log(d.INFO,p.USER_FORCED_IN_VARIATION,I,r,n),i.push([p.USER_FORCED_IN_VARIATION,I,r,n]),{result:e.variationKeyMap[n],reasons:i}):(this.logger.log(d.ERROR,p.FORCED_BUCKETING_FAILED,I,n,r),i.push([p.FORCED_BUCKETING_FAILED,I,n,r]),{result:null,reasons:i})}return{result:null,reasons:i}},t.prototype.checkIfUserIsInAudience=function(e,r,i,n,o){var a=[],u=function(c,f){var E=c.experimentIdMap[f];if(!E)throw new Error(b(m.INVALID_EXPERIMENT_ID,M,f));return E.audienceConditions||E.audienceIds}(e,r.id),s=e.audiencesById;this.logger.log(d.DEBUG,p.EVALUATING_AUDIENCES_COMBINED,I,i,o||r.key,JSON.stringify(u)),a.push([p.EVALUATING_AUDIENCES_COMBINED,I,i,o||r.key,JSON.stringify(u)]);var l=this.audienceEvaluator.evaluate(u,s,n);return this.logger.log(d.INFO,p.AUDIENCE_EVALUATION_RESULT_COMBINED,I,i,o||r.key,l.toString().toUpperCase()),a.push([p.AUDIENCE_EVALUATION_RESULT_COMBINED,I,i,o||r.key,l.toString().toUpperCase()]),{result:l,reasons:a}},t.prototype.buildBucketerParams=function(e,r,i,n){return{bucketingId:i,experimentId:r.id,experimentKey:r.key,experimentIdMap:e.experimentIdMap,experimentKeyMap:e.experimentKeyMap,groupIdMap:e.groupIdMap,logger:this.logger,trafficAllocationConfig:tl(e,r.id),userId:n,variationIdMap:e.variationIdMap}},t.prototype.getStoredVariation=function(e,r,i,n){if(n.hasOwnProperty(r.id)){var o=n[r.id],a=o.variation_id;if(e.variationIdMap.hasOwnProperty(a))return e.variationIdMap[o.variation_id];this.logger.log(d.INFO,p.SAVED_VARIATION_NOT_FOUND,I,i,a,r.key)}return null},t.prototype.getUserProfile=function(e){var r={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return r;try{return this.userProfileService.lookup(e)}catch(i){this.logger.log(d.ERROR,m.USER_PROFILE_LOOKUP_ERROR,I,e,i.message)}return null},t.prototype.saveUserProfile=function(e,r,i,n){if(this.userProfileService)try{n[e.id]={variation_id:r.id},this.userProfileService.save({user_id:i,experiment_bucket_map:n}),this.logger.log(d.INFO,p.SAVED_VARIATION,I,r.key,e.key,i)}catch(o){this.logger.log(d.ERROR,m.USER_PROFILE_SAVE_ERROR,I,i,o.message)}},t.prototype.getVariationForFeature=function(e,r,i,n){n===void 0&&(n={});var o=[],a=this.getVariationForFeatureExperiment(e,r,i,n);o.push.apply(o,a.reasons);var u=a.result;if(u.variation!==null)return{result:u,reasons:o};var s=this.getVariationForRollout(e,r,i);o.push.apply(o,s.reasons);var l=s.result,c=i.getUserId();return l.variation?(this.logger.log(d.DEBUG,p.USER_IN_ROLLOUT,I,c,r.key),o.push([p.USER_IN_ROLLOUT,I,c,r.key]),{result:l,reasons:o}):(this.logger.log(d.DEBUG,p.USER_NOT_IN_ROLLOUT,I,c,r.key),o.push([p.USER_NOT_IN_ROLLOUT,I,c,r.key]),{result:l,reasons:o})},t.prototype.getVariationForFeatureExperiment=function(e,r,i,n){n===void 0&&(n={});var o,a,u=[],s=null;if(r.experimentIds.length>0)for(a=0;a<r.experimentIds.length;a++){var l=rl(e,r.experimentIds[a],this.logger);if(l&&(o=this.getVariationFromExperimentRule(e,r.key,l,i,n),u.push.apply(u,o.reasons),s=o.result)){var c=null;return(c=l.variationKeyMap[s])||(c=un(e,r.key,s)),{result:{experiment:l,variation:c,decisionSource:x.FEATURE_TEST},reasons:u}}}else this.logger.log(d.DEBUG,p.FEATURE_HAS_NO_EXPERIMENTS,I,r.key),u.push([p.FEATURE_HAS_NO_EXPERIMENTS,I,r.key]);return{result:{experiment:null,variation:null,decisionSource:x.FEATURE_TEST},reasons:u}},t.prototype.getVariationForRollout=function(e,r,i){var n=[];if(!r.rolloutId)return this.logger.log(d.DEBUG,p.NO_ROLLOUT_EXISTS,I,r.key),n.push([p.NO_ROLLOUT_EXISTS,I,r.key]),{result:{experiment:null,variation:null,decisionSource:x.ROLLOUT},reasons:n};var o=e.rolloutIdMap[r.rolloutId];if(!o)return this.logger.log(d.ERROR,m.INVALID_ROLLOUT_ID,I,r.rolloutId,r.key),n.push([m.INVALID_ROLLOUT_ID,I,r.rolloutId,r.key]),{result:{experiment:null,variation:null,decisionSource:x.ROLLOUT},reasons:n};var a,u,s,l=o.experiments;if(l.length===0)return this.logger.log(d.ERROR,p.ROLLOUT_HAS_NO_EXPERIMENTS,I,r.rolloutId),n.push([p.ROLLOUT_HAS_NO_EXPERIMENTS,I,r.rolloutId]),{result:{experiment:null,variation:null,decisionSource:x.ROLLOUT},reasons:n};for(var c=0;c<l.length;){if(a=this.getVariationFromDeliveryRule(e,r.key,l,c,i),n.push.apply(n,a.reasons),s=a.result,u=a.skipToEveryoneElse,s)return{result:{experiment:e.experimentIdMap[l[c].id],variation:s,decisionSource:x.ROLLOUT},reasons:n};c=u?l.length-1:c+1}return{result:{experiment:null,variation:null,decisionSource:x.ROLLOUT},reasons:n}},t.prototype.getBucketingId=function(e,r){var i=e;return r!=null&&typeof r=="object"&&r.hasOwnProperty(re.BUCKETING_ID)&&(typeof r[re.BUCKETING_ID]=="string"?(i=r[re.BUCKETING_ID],this.logger.log(d.DEBUG,p.VALID_BUCKETING_ID,I,i)):this.logger.log(d.WARNING,p.BUCKETING_ID_NOT_STRING,I)),i},t.prototype.findValidatedForcedDecision=function(e,r,i,n){var o,a=[],u=r.getForcedDecision({flagKey:i,ruleKey:n}),s=null,l=r.getUserId();return e&&u&&(o=u.variationKey,(s=un(e,i,o))?n?(this.logger.log(d.INFO,p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,o,i,n,l),a.push([p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,o,i,n,l])):(this.logger.log(d.INFO,p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,o,i,l),a.push([p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,o,i,l])):n?(this.logger.log(d.INFO,p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,i,n,l),a.push([p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,i,n,l])):(this.logger.log(d.INFO,p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,i,l),a.push([p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,i,l]))),{result:s,reasons:a}},t.prototype.removeForcedVariation=function(e,r,i){if(!e)throw new Error(b(m.INVALID_USER_ID,I));if(!this.forcedVariationMap.hasOwnProperty(e))throw new Error(b(m.USER_NOT_IN_FORCED_VARIATION,I,e));delete this.forcedVariationMap[e][r],this.logger.log(d.DEBUG,p.VARIATION_REMOVED_FOR_USER,I,i,e)},t.prototype.setInForcedVariationMap=function(e,r,i){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][r]=i,this.logger.log(d.DEBUG,p.USER_MAPPED_TO_FORCED_VARIATION,I,i,r,e)},t.prototype.getForcedVariation=function(e,r,i){var n,o=[],a=this.forcedVariationMap[i];if(!a)return this.logger.log(d.DEBUG,p.USER_HAS_NO_FORCED_VARIATION,I,i),{result:null,reasons:o};try{var u=vr(e,r);if(!u.hasOwnProperty("id"))return this.logger.log(d.ERROR,m.IMPROPERLY_FORMATTED_EXPERIMENT,I,r),o.push([m.IMPROPERLY_FORMATTED_EXPERIMENT,I,r]),{result:null,reasons:o};n=u.id}catch(c){return this.logger.log(d.ERROR,c.message),o.push(c.message),{result:null,reasons:o}}var s=a[n];if(!s)return this.logger.log(d.DEBUG,p.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,I,r,i),{result:null,reasons:o};var l=Un(e,s);return l?(this.logger.log(d.DEBUG,p.USER_HAS_FORCED_VARIATION,I,l,r,i),o.push([p.USER_HAS_FORCED_VARIATION,I,l,r,i])):this.logger.log(d.DEBUG,p.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,I,r,i),{result:l,reasons:o}},t.prototype.setForcedVariation=function(e,r,i,n){if(n!=null&&!Fn(n))return this.logger.log(d.ERROR,m.INVALID_VARIATION_KEY,I),!1;var o;try{var a=vr(e,r);if(!a.hasOwnProperty("id"))return this.logger.log(d.ERROR,m.IMPROPERLY_FORMATTED_EXPERIMENT,I,r),!1;o=a.id}catch(s){return this.logger.log(d.ERROR,s.message),!1}if(n==null)try{return this.removeForcedVariation(i,o,r),!0}catch(s){return this.logger.log(d.ERROR,s.message),!1}var u=function(s,l,c){var f=s.experimentKeyMap[l];return f.variationKeyMap.hasOwnProperty(c)?f.variationKeyMap[c].id:null}(e,r,n);if(!u)return this.logger.log(d.ERROR,m.NO_VARIATION_FOR_EXPERIMENT_KEY,I,n,r),!1;try{return this.setInForcedVariationMap(i,o,u),!0}catch(s){return this.logger.log(d.ERROR,s.message),!1}},t.prototype.getVariationFromExperimentRule=function(e,r,i,n,o){o===void 0&&(o={});var a=[],u=this.findValidatedForcedDecision(e,n,r,i.key);a.push.apply(a,u.reasons);var s=u.result;if(s)return{result:s.key,reasons:a};var l=this.getVariation(e,i,n,o);return a.push.apply(a,l.reasons),{result:l.result,reasons:a}},t.prototype.getVariationFromDeliveryRule=function(e,r,i,n,o){var a=[],u=!1,s=i[n],l=this.findValidatedForcedDecision(e,o,r,s.key);a.push.apply(a,l.reasons);var c=l.result;if(c)return{result:c,reasons:a,skipToEveryoneElse:u};var f,E,v,R,_,g=o.getUserId(),O=o.getAttributes(),h=this.getBucketingId(g,O),N=n===i.length-1,S=N?"Everyone Else":n+1,oe=null,Z=this.checkIfUserIsInAudience(e,s,Er.RULE,O,S);return a.push.apply(a,Z.reasons),Z.result?(this.logger.log(d.DEBUG,p.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,I,g,S),a.push([p.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,I,g,S]),E=this.buildBucketerParams(e,s,h,g),v=cn(E),a.push.apply(a,v.reasons),(f=v.result)&&(_=f,oe=(R=e).variationIdMap.hasOwnProperty(_)?R.variationIdMap[_]:null),oe?(this.logger.log(d.DEBUG,p.USER_BUCKETED_INTO_TARGETING_RULE,I,g,S),a.push([p.USER_BUCKETED_INTO_TARGETING_RULE,I,g,S])):N||(this.logger.log(d.DEBUG,p.USER_NOT_BUCKETED_INTO_TARGETING_RULE,I,g,S),a.push([p.USER_NOT_BUCKETED_INTO_TARGETING_RULE,I,g,S]),u=!0)):(this.logger.log(d.DEBUG,p.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,I,g,S),a.push([p.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,I,g,S])),{result:oe,reasons:a,skipToEveryoneElse:u}},t}();function xn(t,e){if(t.hasOwnProperty("revenue")){var r=t.revenue,i=void 0;return typeof r=="string"?(i=parseInt(r),isNaN(i)?(e.log(d.INFO,p.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r),null):(e.log(d.INFO,p.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",i),i)):typeof r=="number"?(i=r,e.log(d.INFO,p.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",i),i):null}return null}function Mn(t,e){if(t.hasOwnProperty("value")){var r=t.value,i=void 0;return typeof r=="string"?(i=parseFloat(r),isNaN(i)?(e.log(d.INFO,p.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r),null):(e.log(d.INFO,p.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",i),i)):typeof r=="number"?(i=r,e.log(d.INFO,p.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",i),i):null}return null}function kn(t,e){return typeof t=="string"&&(typeof e=="string"||typeof e=="boolean"||U.isNumber(e)&&U.isSafeInteger(e))}var Gn="https://logx.optimizely.com/v1/events";function Kn(t){var e=t.attributes,r=t.userId,i=t.clientEngine,n=t.clientVersion,o=t.configObj,a=t.logger,u=!!o.anonymizeIP&&o.anonymizeIP,s=o.botFiltering,l={snapshots:[],visitor_id:r,attributes:[]},c={account_id:o.accountId,project_id:o.projectId,visitors:[l],revision:o.revision,client_name:i,client_version:n,anonymize_ip:u,enrich_decisions:!0};return e&&Object.keys(e||{}).forEach(function(f){if(kn(f,e[f])){var E=Nn(o,f,a);E&&c.visitors[0].attributes.push({entity_id:E,key:f,type:"custom",value:e[f]})}}),typeof s=="boolean"&&c.visitors[0].attributes.push({entity_id:re.BOT_FILTERING,key:re.BOT_FILTERING,type:"custom",value:s}),c}function cl(t){var e,r,i,n,o,a,u,s,l,c=Kn(t),f=(e=t.configObj,r=t.experimentId,i=t.variationId,n=t.ruleKey,o=t.ruleType,a=t.flagKey,u=t.enabled,s=r?Tn(e,r):null,l=i?Un(e,i):null,{decisions:[{campaign_id:s,experiment_id:r,variation_id:i,metadata:{flag_key:a,rule_key:n,rule_type:o,variation_key:l=l||"",enabled:u}}],events:[{entity_id:s,timestamp:U.currentTimestamp(),key:"campaign_activated",uuid:U.uuid()}]});return c.visitors[0].snapshots.push(f),{httpVerb:"POST",url:Gn,params:c}}function fl(t){var e=Kn(t),r=function(i,n,o,a){var u={events:[]},s={entity_id:An(i,n),timestamp:U.currentTimestamp(),uuid:U.uuid(),key:n};if(a){var l=xn(a,o);l!==null&&(s.revenue=l);var c=Mn(a,o);c!==null&&(s.value=c),s.tags=a}return u.events.push(s),u}(t.configObj,t.eventKey,t.logger,t.eventTags);return e.visitors[0].snapshots=[r],{httpVerb:"POST",url:Gn,params:e}}function fr(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function dr(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function ft(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.featureEnabled)!==null&&r!==void 0&&r}function pn(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}function En(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}var _r=w.getLogger("EVENT_BUILDER");function gn(t,e){var r=[];return e&&Object.keys(e||{}).forEach(function(i){if(kn(i,e[i])){var n=Nn(t,i,_r);n&&r.push({entityId:n,key:i,value:e[i]})}}),r}var pr="USER_PROFILE_SERVICE_VALIDATOR",dl=function(){function t(e){var r,i=this,n=e.clientEngine;n||(e.logger.log(d.INFO,p.INVALID_CLIENT_ENGINE,"OPTIMIZELY",n),n="node-sdk"),this.clientEngine=n,this.clientVersion=e.clientVersion||"4.9.2",this.errorHandler=e.errorHandler,this.isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger;var o=(r=e.defaultDecideOptions)!==null&&r!==void 0?r:[];Array.isArray(o)||(this.logger.log(d.DEBUG,p.INVALID_DEFAULT_DECIDE_OPTIONS,"OPTIMIZELY"),o=[]);var a={};o.forEach(function(f){C.OptimizelyDecideOption[f]?a[f]=!0:i.logger.log(d.WARNING,p.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",f)}),this.defaultDecideOptions=a,this.projectConfigManager=function(f){return new il(f)}({datafile:e.datafile,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey,datafileManager:e.datafileManager}),this.disposeOnUpdate=this.projectConfigManager.onUpdate(function(f){i.logger.log(d.INFO,p.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",f.revision,f.projectId),i.notificationCenter.sendNotifications(B.OPTIMIZELY_CONFIG_UPDATE)});var u,s=this.projectConfigManager.onReady(),l=null;if(e.userProfileService)try{(function(f){if(typeof f=="object"&&f!==null){if(typeof f.lookup!="function")throw new Error(b(m.INVALID_USER_PROFILE_SERVICE,pr,"Missing function 'lookup'"));if(typeof f.save!="function")throw new Error(b(m.INVALID_USER_PROFILE_SERVICE,pr,"Missing function 'save'"));return!0}throw new Error(b(m.INVALID_USER_PROFILE_SERVICE,pr))})(e.userProfileService)&&(l=e.userProfileService,this.logger.log(d.INFO,p.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY"))}catch(f){this.logger.log(d.WARNING,f.message)}this.decisionService=(u={userProfileService:l,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators},new ll(u)),this.notificationCenter=e.notificationCenter,this.eventProcessor=e.eventProcessor;var c=this.eventProcessor.start();this.readyPromise=Promise.all([s,c]).then(function(f){return f[0]}),this.readyTimeouts={},this.nextReadyTimeoutId=0}return t.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},t.prototype.activate=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","activate"),null;if(!this.validateInputs({experiment_key:e,user_id:r},i))return this.notActivatingExperiment(e,r);var n=this.projectConfigManager.getConfig();if(!n)return null;try{var o=this.getVariation(e,r,i);if(o===null)return this.notActivatingExperiment(e,r);if(!function(s,l){return bn(s,l)==="Running"}(n,e))return this.logger.log(d.DEBUG,p.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e),o;var a=vr(n,e),u={experiment:a,variation:a.variationKeyMap[o],decisionSource:x.EXPERIMENT};return this.sendImpressionEvent(u,"",r,!0,i),o}catch(s){return this.logger.log(d.ERROR,s.message),this.logger.log(d.INFO,p.NOT_ACTIVATING_USER,"OPTIMIZELY",r,e),this.errorHandler.handleError(s),null}}catch(s){return this.logger.log(d.ERROR,s.message),this.errorHandler.handleError(s),null}},t.prototype.sendImpressionEvent=function(e,r,i,n,o){var a=this.projectConfigManager.getConfig();if(a){var u=function(s){var l=s.configObj,c=s.decisionObj,f=s.userId,E=s.flagKey,v=s.enabled,R=s.userAttributes,_=s.clientEngine,g=s.clientVersion,O=c.decisionSource,h=fr(c),N=pn(c),S=dr(c),oe=En(c),Z=N!==null?Tn(l,N):null;return{type:"impression",timestamp:U.currentTimestamp(),uuid:U.uuid(),user:{id:f,attributes:gn(l,R)},context:{accountId:l.accountId,projectId:l.projectId,revision:l.revision,clientName:_,clientVersion:g,anonymizeIP:l.anonymizeIP||!1,botFiltering:l.botFiltering},layer:{id:Z},experiment:{id:N,key:h},variation:{id:oe,key:S},ruleKey:h,flagKey:E,ruleType:O,enabled:v}}({decisionObj:e,flagKey:r,enabled:n,userId:i,userAttributes:o,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a});this.eventProcessor.process(u),this.emitNotificationCenterActivate(e,r,i,n,o)}},t.prototype.emitNotificationCenterActivate=function(e,r,i,n,o){var a=this.projectConfigManager.getConfig();if(a){var u,s=e.decisionSource,l=fr(e),c=pn(e),f=dr(e),E=En(e);c!==null&&f!==""&&(u=a.experimentIdMap[c]);var v,R=cl({attributes:o,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a,experimentId:c,ruleKey:l,flagKey:r,ruleType:s,userId:i,enabled:n,variationId:E,logger:this.logger});u&&u.variationKeyMap&&f!==""&&(v=u.variationKeyMap[f]),this.notificationCenter.sendNotifications(B.ACTIVATE,{experiment:u,userId:i,attributes:o,variation:v,logEvent:R})}},t.prototype.track=function(e,r,i,n){try{if(!this.isValidInstance())return void this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","track");if(!this.validateInputs({user_id:r,event_key:e},i,n))return;var o=this.projectConfigManager.getConfig();if(!o)return;if(!function(u,s){return u.eventKeyMap.hasOwnProperty(s)}(o,e))return this.logger.log(d.WARNING,p.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e),void this.logger.log(d.WARNING,p.NOT_TRACKING_USER,"OPTIMIZELY",r);var a=function(u){var s=u.configObj,l=u.userId,c=u.userAttributes,f=u.clientEngine,E=u.clientVersion,v=u.eventKey,R=u.eventTags,_=An(s,v),g=R?xn(R,_r):null,O=R?Mn(R,_r):null;return{type:"conversion",timestamp:U.currentTimestamp(),uuid:U.uuid(),user:{id:l,attributes:gn(s,c)},context:{accountId:s.accountId,projectId:s.projectId,revision:s.revision,clientName:f,clientVersion:E,anonymizeIP:s.anonymizeIP||!1,botFiltering:s.botFiltering},event:{id:_,key:v},revenue:g,value:O,tags:R}}({eventKey:e,eventTags:n=this.filterEmptyValues(n),userId:r,userAttributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o});this.logger.log(d.INFO,p.TRACK_EVENT,"OPTIMIZELY",e,r),this.eventProcessor.process(a),this.emitNotificationCenterTrack(e,r,i,n)}catch(u){this.logger.log(d.ERROR,u.message),this.errorHandler.handleError(u),this.logger.log(d.ERROR,p.NOT_TRACKING_USER,"OPTIMIZELY",r)}},t.prototype.emitNotificationCenterTrack=function(e,r,i,n){try{var o=this.projectConfigManager.getConfig();if(!o)return;var a=fl({attributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o,eventKey:e,eventTags:n,logger:this.logger,userId:r});this.notificationCenter.sendNotifications(B.TRACK,{eventKey:e,userId:r,attributes:i,eventTags:n,logEvent:a})}catch(u){this.logger.log(d.ERROR,u.message),this.errorHandler.handleError(u)}},t.prototype.getVariation=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getVariation"),null;try{if(!this.validateInputs({experiment_key:e,user_id:r},i))return null;var n=this.projectConfigManager.getConfig();if(!n)return null;var o=n.experimentKeyMap[e];if(!o)return this.logger.log(d.DEBUG,m.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e),null;var a=this.decisionService.getVariation(n,o,this.createUserContext(r,i)).result,u=(s=n,l=o.id,s.experimentFeatureMap.hasOwnProperty(l)?ve.FEATURE_TEST:ve.AB_TEST);return this.notificationCenter.sendNotifications(B.DECISION,{type:u,userId:r,attributes:i||{},decisionInfo:{experimentKey:e,variationKey:a}}),a}catch(c){return this.logger.log(d.ERROR,c.message),this.errorHandler.handleError(c),null}}catch(c){return this.logger.log(d.ERROR,c.message),this.errorHandler.handleError(c),null}var s,l},t.prototype.setForcedVariation=function(e,r,i){if(!this.validateInputs({experiment_key:e,user_id:r}))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;try{return this.decisionService.setForcedVariation(n,e,r,i)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),!1}},t.prototype.getForcedVariation=function(e,r){if(!this.validateInputs({experiment_key:e,user_id:r}))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;try{return this.decisionService.getForcedVariation(i,e,r).result}catch(n){return this.logger.log(d.ERROR,n.message),this.errorHandler.handleError(n),null}},t.prototype.validateInputs=function(e,r,i){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if(typeof n!="string"||n===null||n==="undefined")throw new Error(b(m.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}return Object.keys(e).forEach(function(o){if(!Fn(e[o]))throw new Error(b(m.INVALID_INPUT_FORMAT,"OPTIMIZELY",o))}),r&&function(o){if(typeof o!="object"||Array.isArray(o)||o===null)throw new Error(b(m.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(o).forEach(function(a){if(o[a]===void 0)throw new Error(b(m.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",a))})}(r),i&&function(o){if(typeof o!="object"||Array.isArray(o)||o===null)throw new Error(b(m.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(i),!0}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),!1}},t.prototype.notActivatingExperiment=function(e,r){return this.logger.log(d.INFO,p.NOT_ACTIVATING_USER,"OPTIMIZELY",r,e),null},t.prototype.filterEmptyValues=function(e){for(var r in e)!e.hasOwnProperty(r)||e[r]!==null&&e[r]!==void 0||delete e[r];return e},t.prototype.isFeatureEnabled=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled"),!1;if(!this.validateInputs({feature_key:e,user_id:r},i))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;var o=cr(n,e,this.logger);if(!o)return!1;var a={},u=this.createUserContext(r,i),s=this.decisionService.getVariationForFeature(n,o,u).result,l=s.decisionSource,c=fr(s),f=dr(s),E=ft(s);l===x.FEATURE_TEST&&(a={experimentKey:c,variationKey:f}),(l===x.FEATURE_TEST||l===x.ROLLOUT&&ln(n))&&this.sendImpressionEvent(s,o.key,r,E,i),E===!0?this.logger.log(d.INFO,p.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,r):(this.logger.log(d.INFO,p.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,r),E=!1);var v={featureKey:e,featureEnabled:E,source:s.decisionSource,sourceInfo:a};return this.notificationCenter.sendNotifications(B.DECISION,{type:ve.FEATURE,userId:r,attributes:i||{},decisionInfo:v}),E}catch(R){return this.logger.log(d.ERROR,R.message),this.errorHandler.handleError(R),!1}},t.prototype.getEnabledFeatures=function(e,r){var i=this;try{var n=[];if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures"),n;if(!this.validateInputs({user_id:e}))return n;var o=this.projectConfigManager.getConfig();return o&&ne(o.featureKeyMap).forEach(function(a){i.isFeatureEnabled(a.key,e,r)&&n.push(a.key)}),n}catch(a){return this.logger.log(d.ERROR,a.message),this.errorHandler.handleError(a),[]}},t.prototype.getFeatureVariable=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,null,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariable"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableForType=function(e,r,i,n,o){if(!this.validateInputs({feature_key:e,variable_key:r,user_id:n},o))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var u=cr(a,e,this.logger);if(!u)return null;var s=function(R,_,g,O){var h=R.featureKeyMap[_];if(!h)return O.log(d.ERROR,m.FEATURE_NOT_IN_DATAFILE,M,_),null;var N=h.variableKeyMap[g];return N||(O.log(d.ERROR,m.VARIABLE_KEY_NOT_IN_DATAFILE,M,g,_),null)}(a,e,r,this.logger);if(!s)return null;if(i&&s.type!==i)return this.logger.log(d.WARNING,p.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",i,s.type),null;var l=this.createUserContext(n,o),c=this.decisionService.getVariationForFeature(a,u,l).result,f=ft(c),E=this.getFeatureVariableValueFromVariation(e,f,c.variation,s,n),v={};return c.decisionSource===x.FEATURE_TEST&&c.experiment!==null&&c.variation!==null&&(v={experimentKey:c.experiment.key,variationKey:c.variation.key}),this.notificationCenter.sendNotifications(B.DECISION,{type:ve.FEATURE_VARIABLE,userId:n,attributes:o||{},decisionInfo:{featureKey:e,featureEnabled:f,source:c.decisionSource,variableKey:r,variableValue:E,variableType:s.type,sourceInfo:v}}),E},t.prototype.getFeatureVariableValueFromVariation=function(e,r,i,n,o){var a=this.projectConfigManager.getConfig();if(!a)return null;var u=n.defaultValue;if(i!==null){var s=function(l,c,f,E){if(!c||!f)return null;if(!l.variationVariableUsageMap.hasOwnProperty(f.id))return E.log(d.ERROR,m.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,M,f.id),null;var v=l.variationVariableUsageMap[f.id][c.id];return v?v.value:null}(a,n,i,this.logger);s!==null?r?(u=s,this.logger.log(d.INFO,p.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",u,n.key,e)):this.logger.log(d.INFO,p.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",e,o,u):this.logger.log(d.INFO,p.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",n.key,i.key)}else this.logger.log(d.INFO,p.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",o,n.key,e);return function(l,c,f){var E;switch(c){case q.BOOLEAN:l!=="true"&&l!=="false"?(f.log(d.ERROR,m.UNABLE_TO_CAST_VALUE,M,l,c),E=null):E=l==="true";break;case q.INTEGER:E=parseInt(l,10),isNaN(E)&&(f.log(d.ERROR,m.UNABLE_TO_CAST_VALUE,M,l,c),E=null);break;case q.DOUBLE:E=parseFloat(l),isNaN(E)&&(f.log(d.ERROR,m.UNABLE_TO_CAST_VALUE,M,l,c),E=null);break;case q.JSON:try{E=JSON.parse(l)}catch{f.log(d.ERROR,m.UNABLE_TO_CAST_VALUE,M,l,c),E=null}break;default:E=l}return E}(u,n.type,this.logger)},t.prototype.getFeatureVariableBoolean=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,q.BOOLEAN,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableBoolean"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableDouble=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,q.DOUBLE,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableDouble"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableInteger=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,q.INTEGER,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableInteger"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableString=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,q.STRING,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableString"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableJSON=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,q.JSON,i,n):(this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableJSON"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getAllFeatureVariables=function(e,r,i){var n=this;try{if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getAllFeatureVariables"),null;if(!this.validateInputs({feature_key:e,user_id:r},i))return null;var o=this.projectConfigManager.getConfig();if(!o)return null;var a=cr(o,e,this.logger);if(!a)return null;var u=this.createUserContext(r,i),s=this.decisionService.getVariationForFeature(o,a,u).result,l=ft(s),c={};a.variables.forEach(function(E){c[E.key]=n.getFeatureVariableValueFromVariation(e,l,s.variation,E,r)});var f={};return s.decisionSource===x.FEATURE_TEST&&s.experiment!==null&&s.variation!==null&&(f={experimentKey:s.experiment.key,variationKey:s.variation.key}),this.notificationCenter.sendNotifications(B.DECISION,{type:ve.ALL_FEATURE_VARIABLES,userId:r,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:l,source:s.decisionSource,variableValues:c,sourceInfo:f}}),c}catch(E){return this.logger.log(d.ERROR,E.message),this.errorHandler.handleError(E),null}},t.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},t.prototype.close=function(){var e=this;try{var r=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach(function(i){var n=e.readyTimeouts[i];clearTimeout(n.readyTimeout),n.onClose()}),this.readyTimeouts={},r.then(function(){return{success:!0}},function(i){return{success:!1,reason:String(i)}})}catch(i){return this.logger.log(d.ERROR,i.message),this.errorHandler.handleError(i),Promise.resolve({success:!1,reason:String(i)})}},t.prototype.onReady=function(e){var r,i,n=this;typeof e=="object"&&e!==null&&e.timeout!==void 0&&(r=e.timeout),U.isSafeInteger(r)||(r=3e4);var o=new Promise(function(s){i=s}),a=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var u=setTimeout(function(){delete n.readyTimeouts[a],i({success:!1,reason:b("onReady timeout expired after %s ms",r)})},r);return this.readyTimeouts[a]={readyTimeout:u,onClose:function(){i({success:!1,reason:"Instance closed"})}},this.readyPromise.then(function(){clearTimeout(u),delete n.readyTimeouts[a],i({success:!0})}),Promise.race([this.readyPromise,o])},t.prototype.createUserContext=function(e,r){return this.validateInputs({user_id:e},r)?new Qu({optimizely:this,userId:e,attributes:r}):null},t.prototype.decide=function(e,r,i){var n,o,a,u,s=this;i===void 0&&(i=[]);var l,c=e.getUserId(),f=e.getAttributes(),E=this.projectConfigManager.getConfig(),v=[];if(!this.isValidInstance()||!E)return this.logger.log(d.INFO,p.INVALID_OBJECT,"OPTIMIZELY","decide"),sn(r,e,[gr.SDK_NOT_READY]);var R=E.featureKeyMap[r];if(!R)return this.logger.log(d.ERROR,m.FEATURE_NOT_IN_DATAFILE,"OPTIMIZELY",r),sn(r,e,[b(gr.FLAG_KEY_INVALID,r)]);var _=this.getAllDecideOptions(i),g=this.decisionService.findValidatedForcedDecision(E,e,r);v.push.apply(v,g.reasons);var O=g.result;if(O)l={experiment:null,variation:O,decisionSource:x.FEATURE_TEST};else{var h=this.decisionService.getVariationForFeature(E,R,e,_);v.push.apply(v,h.reasons),l=h.result}var N=l.decisionSource,S=(o=(n=l.experiment)===null||n===void 0?void 0:n.key)!==null&&o!==void 0?o:null,oe=(u=(a=l.variation)===null||a===void 0?void 0:a.key)!==null&&u!==void 0?u:null,Z=ft(l);Z===!0?this.logger.log(d.INFO,p.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",r,c):this.logger.log(d.INFO,p.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",r,c);var yt={},Vr=!1;_[C.OptimizelyDecideOption.EXCLUDE_VARIABLES]||R.variables.forEach(function(Pe){yt[Pe.key]=s.getFeatureVariableValueFromVariation(r,Z,l.variation,Pe,c)}),!_[C.OptimizelyDecideOption.DISABLE_DECISION_EVENT]&&(N===x.FEATURE_TEST||N===x.ROLLOUT&&ln(E))&&(this.sendImpressionEvent(l,r,c,Z,f),Vr=!0);var mt=[];_[C.OptimizelyDecideOption.INCLUDE_REASONS]&&(mt=v.map(function(Pe){return b.apply(void 0,Ir([Pe[0]],Pe.slice(1)))}));var So={flagKey:r,enabled:Z,variationKey:oe,ruleKey:S,variables:yt,reasons:mt,decisionEventDispatched:Vr};return this.notificationCenter.sendNotifications(B.DECISION,{type:ve.FLAG,userId:c,attributes:f,decisionInfo:So}),{variationKey:oe,enabled:Z,variables:yt,ruleKey:S,flagKey:r,userContext:e,reasons:mt}},t.prototype.getAllDecideOptions=function(e){var r=this,i=he({},this.defaultDecideOptions);return Array.isArray(e)?e.forEach(function(n){C.OptimizelyDecideOption[n]?i[n]=!0:r.logger.log(d.WARNING,p.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",n)}):this.logger.log(d.DEBUG,p.INVALID_DECIDE_OPTIONS,"OPTIMIZELY"),i},t.prototype.decideForKeys=function(e,r,i){var n=this;i===void 0&&(i=[]);var o={};if(!this.isValidInstance())return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","decideForKeys"),o;if(r.length===0)return o;var a=this.getAllDecideOptions(i);return r.forEach(function(u){var s=n.decide(e,u,i);a[C.OptimizelyDecideOption.ENABLED_FLAGS_ONLY]&&!s.enabled||(o[u]=s)}),o},t.prototype.decideAll=function(e,r){r===void 0&&(r=[]);var i=this.projectConfigManager.getConfig();if(!this.isValidInstance()||!i)return this.logger.log(d.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","decideAll"),{};var n=Object.keys(i.featureKeyMap);return this.decideForKeys(e,n,r)},t}(),pl=function(t){return!(typeof t!="number"||!U.isSafeInteger(t))&&t>=1},El=function(t){return!(typeof t!="number"||!U.isSafeInteger(t))&&t>0},gl=function(){function t(e){var r=this;this.logger=e.logger,this.errorHandler=e.errorHandler,this.notificationListeners={},ne(B).forEach(function(i){r.notificationListeners[i]=[]}),this.listenerId=1}return t.prototype.addNotificationListener=function(e,r){try{if(!(ne(B).indexOf(e)>-1))return-1;this.notificationListeners[e]||(this.notificationListeners[e]=[]);var i=!1;if((this.notificationListeners[e]||[]).forEach(function(o){o.callback!==r||(i=!0)}),i)return-1;this.notificationListeners[e].push({id:this.listenerId,callback:r});var n=this.listenerId;return this.listenerId+=1,n}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),-1}},t.prototype.removeNotificationListener=function(e){var r=this;try{var i,n;if(Object.keys(this.notificationListeners).some(function(o){return(r.notificationListeners[o]||[]).every(function(a,u){return a.id!==e||(i=u,n=o,!1)}),i!==void 0&&n!==void 0}),i!==void 0&&n!==void 0)return this.notificationListeners[n].splice(i,1),!0}catch(o){this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o)}return!1},t.prototype.clearAllNotificationListeners=function(){var e=this;try{ne(B).forEach(function(r){e.notificationListeners[r]=[]})}catch(r){this.logger.log(d.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.clearNotificationListeners=function(e){try{this.notificationListeners[e]=[]}catch(r){this.logger.log(d.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.sendNotifications=function(e,r){var i=this;try{(this.notificationListeners[e]||[]).forEach(function(n){var o=n.callback;try{o(r)}catch(a){i.logger.log(d.ERROR,p.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,a.message)}})}catch(n){this.logger.log(d.ERROR,n.message),this.errorHandler.handleError(n)}},t}(),vl={createEventProcessor:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(dt.LogTierV1EventProcessor.bind.apply(dt.LogTierV1EventProcessor,Ir([void 0],t)))},LocalStoragePendingEventsDispatcher:dt.LocalStoragePendingEventsDispatcher};function _l(t,e,r,i){var n={sdkKey:t};if((i===void 0||typeof i=="object"&&i!==null)&&U.assign(n,i),r){var o=Dn({datafile:r,jsonSchemaValidator:void 0,logger:e}),a=o.configObj,u=o.error;u&&e.error(u),a&&(n.datafile=Sn(a))}return new qu.HttpPollingDatafileManager(n)}var le=w.getLogger();w.setLogHandler(mn()),w.setLogLevel(w.LogLevel.INFO);var hr=!1,Bn=function(t){try{var e=!1;t.errorHandler&&w.setErrorHandler(t.errorHandler),t.logger&&(w.setLogHandler(t.logger),w.setLogLevel(w.LogLevel.NOTSET)),t.logLevel!==void 0&&w.setLogLevel(t.logLevel);try{Xu(t),e=!0}catch(f){le.error(f)}var r=void 0;t.eventDispatcher==null?(r=new dt.LocalStoragePendingEventsDispatcher({eventDispatcher:mr}),hr||(r.sendPendingEvents(),hr=!0)):r=t.eventDispatcher;var i=t.eventBatchSize,n=t.eventFlushInterval;pl(t.eventBatchSize)||(le.warn("Invalid eventBatchSize %s, defaulting to %s",t.eventBatchSize,10),i=10),El(t.eventFlushInterval)||(le.warn("Invalid eventFlushInterval %s, defaulting to %s",t.eventFlushInterval,1e3),n=1e3);var o=w.getErrorHandler(),a=new gl({logger:le,errorHandler:o}),u={dispatcher:r,flushInterval:n,batchSize:i,maxQueueSize:t.eventMaxQueueSize||1e4,notificationCenter:a},s=he(he({clientEngine:"javascript-sdk"},t),{eventProcessor:vl.createEventProcessor(u),logger:le,errorHandler:o,datafileManager:t.sdkKey?_l(t.sdkKey,le,t.datafile,t.datafileOptions):void 0,notificationCenter:a,isValidInstance:e}),l=new dl(s);try{if(typeof window.addEventListener=="function"){var c="onpagehide"in window?"pagehide":"unload";window.addEventListener(c,function(){l.close()},!1)}}catch(f){le.error(p.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",f.message)}return l}catch(f){return le.error(f),null}},jn=function(){hr=!1},hl={logging:On,errorHandler:yn,eventDispatcher:mr,enums:In,setLogger:w.setLogHandler,setLogLevel:w.setLogLevel,createInstance:Bn,__internalResetRetryState:jn,OptimizelyDecideOption:C.OptimizelyDecideOption};Object.defineProperty(C,"setLogLevel",{enumerable:!0,get:function(){return w.setLogLevel}}),Object.defineProperty(C,"setLogger",{enumerable:!0,get:function(){return w.setLogHandler}}),C.__internalResetRetryState=jn,C.createInstance=Bn,C.default=hl,C.enums=In,C.errorHandler=yn,C.eventDispatcher=mr,C.logging=On});var Ur=A(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});var T=we(),gt=ee(),Il=Co(),ie=be();function yl(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var ml=yl(Il),Ue=T.createContext({optimizely:null,isServerSide:!1,timeout:0}),Hn=Ue.Consumer,qn=Ue.Provider;var Rr=function(t,e){return Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Rr(t,e)};function Yn(t,e){Rr(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var D=function(){return D=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},D.apply(this,arguments)};function Ol(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Wn(t,e){if(t.id!==e.id)return!1;var r=Object.keys(t.attributes||{}),i=Object.keys(e.attributes||{});r.sort(),i.sort();var n=t.attributes||{},o=e.attributes||{},a=r.length===i.length;if(!a)return!1;for(var u=0;u<r.length;u++){var s=r[u],l=i[u];if(s!==l||n[s]!==o[l])return!1}return!0}function Rl(t,e,r){var i=function(n,o){return T.createElement(t,D({},n,{forwardedRef:o}))};return i.displayName=r+"("+(e.displayName||e.name)+")",ml.default(T.forwardRef(i),e)}function zn(t){return typeof t=="object"&&t!==null?t:{}}function Xn(t,e){var r=zn(t),i=zn(e),n=Object.keys(r),o=Object.keys(i);return n.length!==o.length?!1:n.every(function(a){return a in i&&r[a]===i[a]})}function Be(t,e,r){return{enabled:!1,flagKey:t,ruleKey:null,variationKey:null,variables:{},reasons:[e],userContext:{id:r.id,attributes:r.attributes}}}var Or=gt.getLogger("<OptimizelyProvider>"),Tl=function(t){Yn(e,t);function e(r){var i=t.call(this,r)||this,n=r.optimizely,o=r.userId,a=r.userAttributes,u=r.user,s=null;if(u?"then"in u?u.then(function(l){n.setUser(l)}):s={id:u.id,attributes:u.attributes||{}}:o&&(s={id:o,attributes:a||{}},Or.warn("Passing userId and userAttributes as props is deprecated, please switch to using `user` prop")),s)if(!n)Or.error("Unable to set user "+s+" because optimizely object does not exist.");else try{n.setUser(s)}catch{Or.error("Unable to set user "+s+" because passed in optimizely object does not contain the setUser function.")}return i}return e.prototype.componentDidUpdate=function(r){if(!r.isServerSide){var i=this.props.optimizely;this.props.user&&"id"in this.props.user&&(i.user.id?Wn({id:i.user.id,attributes:i.user.attributes||{}},{id:this.props.user.id,attributes:this.props.user.attributes||{}})||i.setUser(this.props.user):i.setUser(this.props.user))}},e.prototype.render=function(){var r=this.props,i=r.optimizely,n=r.children,o=r.timeout,a=!!this.props.isServerSide,u={optimizely:i,isServerSide:a,timeout:o};return T.createElement(qn,{value:u},n)},e}(T.Component),Tr=function(t,e,r,i,n){var o="re-evaluating "+e+'="'+r+'" for user="'+t.user.id+'"',a=t.notificationCenter.addNotificationListener(ie.enums.NOTIFICATION_TYPES.OPTIMIZELY_CONFIG_UPDATE,function(){i.info(ie.enums.NOTIFICATION_TYPES.OPTIMIZELY_CONFIG_UPDATE+", "+o),n()}),u=function(){return t.notificationCenter.removeNotificationListener(a)},s=t.onUserUpdate(function(){i.info("User update, "+o),n()});return function(){u(),s()}},Nl=function(){function t(){this.observers=[]}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.subscribe=function(e,r){var i=this,n="key-"+Math.floor(1e5+Math.random()*999999);return this.observers.push({subscriptionId:n,key:e,callback:r}),function(){var o=i.observers.findIndex(function(a){return a.subscriptionId===n});o>=0&&i.observers.splice(o,1)}},t.prototype.notify=function(e){this.observers.filter(function(r){return r.key===e}).forEach(function(r){return r.callback()})},t}(),Et=Nl.getInstance(),J=gt.getLogger("ReactSDK"),je;(function(t){t.EXPERIMENT="Experiment",t.FEATURE="Feature"})(je||(je={}));function Nr(t,e){return t.entityKey===e.entityKey&&t.overrideUserId===e.overrideUserId&&Xn(t.overrideAttributes,e.overrideAttributes)}function Ar(t,e,r){t.onReady({timeout:e}).then(function(i){if(i.success){J.info("Client became ready"),r({clientReady:!0,didTimeout:!1});return}switch(i.reason){case"NO_CLIENT":J.warn('Client not ready, reason="'+i.message+'"'),r({clientReady:!1,didTimeout:!1}),i.dataReadyPromise.then(function(){J.info("Client became ready."),r({clientReady:!0,didTimeout:!1})});break;default:J.info("Client did not become ready before timeout of "+e+'ms, reason="'+i.message+'"'),r({clientReady:!1,didTimeout:!0}),i.dataReadyPromise.then(function(){J.info("Client became ready after timeout already elapsed"),r({clientReady:!0,didTimeout:!0})})}}).catch(function(){J.error("Error initializing client. The core client or user promise(s) rejected.")})}function br(t){var e=T.useRef();return Xn(t,e.current)||(e.current=t),e.current}var Jn=function(t,e,r){e===void 0&&(e={}),r===void 0&&(r={});var i=T.useContext(Ue),n=i.optimizely,o=i.isServerSide,a=i.timeout;if(!n)return J.error("Unable to use experiment "+t+". optimizely prop must be supplied via a parent <OptimizelyProvider>"),[null,!1,!1];var u=br(r.overrideAttributes),s=T.useCallback(function(){return{variation:n.activate(t,r.overrideUserId,u)}},[n,t,r.overrideUserId,u]),l=o||n.isReady(),c=T.useState(function(){var h=l?s():{variation:null};return D({},h,{clientReady:l,didTimeout:!1})}),f=c[0],E=c[1],v={entityKey:t,overrideUserId:r.overrideUserId,overrideAttributes:u},R=T.useState(v),_=R[0],g=R[1];Nr(_,v)||(g(v),E(function(h){return D({},h,s())}));var O=e.timeout!==void 0?e.timeout:a;return T.useEffect(function(){(n.getIsUsingSdkKey()&&!n.getIsReadyPromiseFulfilled()||!l)&&Ar(n,O,function(h){E(D({},s(),h))})},[]),T.useEffect(function(){return n.getIsReadyPromiseFulfilled()&&e.autoUpdate?Tr(n,je.EXPERIMENT,t,J,function(){E(function(h){return D({},h,s())})}):function(){}},[n.getIsReadyPromiseFulfilled(),e.autoUpdate,n,t,s]),T.useEffect(function(){return n.onForcedVariationsUpdate(function(){E(function(h){return D({},h,s())})})},[s,n]),[f.variation,f.clientReady,f.didTimeout]},Zn=function(t,e,r){e===void 0&&(e={}),r===void 0&&(r={});var i=T.useContext(Ue),n=i.optimizely,o=i.isServerSide,a=i.timeout;if(!n)return J.error("Unable to properly use feature "+t+". optimizely prop must be supplied via a parent <OptimizelyProvider>"),[!1,{},!1,!1];var u=br(r.overrideAttributes),s=T.useCallback(function(){return{isEnabled:n.isFeatureEnabled(t,r.overrideUserId,u),variables:n.getFeatureVariables(t,r.overrideUserId,u)}},[n,t,r.overrideUserId,u]),l=o||n.isReady(),c=T.useState(function(){var h=l?s():{isEnabled:!1,variables:{}};return D({},h,{clientReady:l,didTimeout:!1})}),f=c[0],E=c[1],v={entityKey:t,overrideUserId:r.overrideUserId,overrideAttributes:r.overrideAttributes},R=T.useState(v),_=R[0],g=R[1];Nr(_,v)||(g(v),E(function(h){return D({},h,s())}));var O=e.timeout!==void 0?e.timeout:a;return T.useEffect(function(){(n.getIsUsingSdkKey()||!l)&&Ar(n,O,function(h){E(D({},s(),h))})},[]),T.useEffect(function(){return n.getIsReadyPromiseFulfilled()&&e.autoUpdate?Tr(n,je.FEATURE,t,J,function(){E(function(h){return D({},h,s())})}):function(){}},[n.getIsReadyPromiseFulfilled(),e.autoUpdate,n,t,s]),[f.isEnabled,f.variables,f.clientReady,f.didTimeout]},Al=function(t,e,r){e===void 0&&(e={}),r===void 0&&(r={});var i=T.useContext(Ue),n=i.optimizely,o=i.isServerSide,a=i.timeout;if(!n)return J.error("Unable to use decision "+t+". optimizely prop must be supplied via a parent <OptimizelyProvider>"),[Be(t,"Optimizely SDK not configured properly yet.",{id:null,attributes:{}}),!1,!1];var u=br(r.overrideAttributes),s=function(){return{decision:n.decide(t,e.decideOptions,r.overrideUserId,u)}},l=o||n.isReady(),c=T.useState(function(){var h=l?s():{decision:Be(t,"Optimizely SDK not configured properly yet.",{id:r.overrideUserId||null,attributes:u})};return D({},h,{clientReady:l,didTimeout:!1})}),f=c[0],E=c[1],v={entityKey:t,overrideUserId:r.overrideUserId,overrideAttributes:r.overrideAttributes},R=T.useState(v),_=R[0],g=R[1];Nr(_,v)||(g(v),E(function(h){return D({},h,s())}));var O=e.timeout!==void 0?e.timeout:a;return T.useEffect(function(){(n.getIsUsingSdkKey()||!l)&&Ar(n,O,function(h){E(D({},s(),h))})},[]),T.useEffect(function(){if(!(r.overrideUserId||r.overrideAttributes||!e.autoUpdate))return Et.subscribe(t,function(){E(function(h){return D({},h,s())})})},[r.overrideUserId,r.overrideAttributes,e.autoUpdate]),T.useEffect(function(){return n.getIsReadyPromiseFulfilled()&&e.autoUpdate?Tr(n,je.FEATURE,t,J,function(){E(function(h){return D({},h,s())})}):function(){}},[n.getIsReadyPromiseFulfilled(),e.autoUpdate,n,t,s]),[f.decision,f.clientReady,f.didTimeout]},bl=function(t){var e=t.feature,r=t.timeout,i=t.autoUpdate,n=t.children,o=t.overrideUserId,a=t.overrideAttributes,u=Zn(e,{timeout:r,autoUpdate:i},{overrideUserId:o,overrideAttributes:a}),s=u[0],l=u[1],c=u[2],f=u[3];return!c&&!f?null:T.createElement(T.Fragment,null,n(s,l,c,f))},Ul=bl;function Sl(t){var e=function(i){Yn(n,i);function n(){return i!==null&&i.apply(this,arguments)||this}return n.prototype.render=function(){var o=this.props,a=o.forwardedRef,u=Ol(o,["forwardedRef"]);return T.createElement(Hn,null,function(s){return T.createElement(t,D({},u,{optimizelyReadyTimeout:s.timeout,optimizely:s.optimizely,isServerSide:s.isServerSide,ref:a}))})},n}(T.Component),r=Rl(e,t,"withOptimizely");return r}var Dl=function(t){var e=t.experiment,r=t.autoUpdate,i=t.timeout,n=t.overrideUserId,o=t.overrideAttributes,a=t.children,u=Jn(e,{timeout:i,autoUpdate:r},{overrideUserId:n,overrideAttributes:o}),s=u[0],l=u[1],c=u[2];if(!l&&!c)return null;if(a!=null&&typeof a=="function")return T.createElement(T.Fragment,null,a(s,l,c));var f=null;return T.Children.forEach(a,function(E){f||!T.isValidElement(E)||(E.props.variation?s===E.props.variation&&(f=E):E.props.default&&(f=E))}),f?T.cloneElement(f,{variation:s}):null},Ll=Dl,Cl=function(t){var e=t.children;return T.createElement(T.Fragment,null,e)},Pl=Cl,y=gt.getLogger("ReactSDK"),wl="react-sdk",Vl="2.9.1",Fl=5e3,xl=function(){function t(e){var r=this;this.user={id:null,attributes:{}},this.userContext=null,this.isUserPromiseResolved=!1,this.onUserUpdateHandlers=[],this.onForcedVariationsUpdateHandlers=[],this.forcedDecisionFlagKeys=new Set,this.isClientReady=!1,this.isReadyPromiseFulfilled=!1,this.isUserReady=!1,this.isUsingSdkKey=!1,this.initialConfig=e,this.userPromiseResolver=function(){};var i=D({},e,{clientEngine:wl,clientVersion:Vl});this._client=ie.createInstance(i),this.isClientReady=!!i.datafile,this.isUsingSdkKey=!!i.sdkKey,this.userPromise=new Promise(function(n){r.userPromiseResolver=n}).then(function(){return r.isUserReady=!0,{success:!0}}),this._client?(this._client.onReady().then(function(){r.isClientReady=!0}),this.dataReadyPromise=Promise.all([this.userPromise,this._client.onReady()]).then(function(){return r.isReadyPromiseFulfilled=!0,{success:!0,message:"Successfully resolved datafile and user information."}})):(y.warn("Unable to resolve datafile and user information because Optimizely client failed to initialize."),this.dataReadyPromise=new Promise(function(n,o){n({success:!1,reason:"NO_CLIENT",message:"Optimizely client failed to initialize."})}))}return t.prototype.getIsReadyPromiseFulfilled=function(){return this.isReadyPromiseFulfilled},t.prototype.getIsUsingSdkKey=function(){return this.isUsingSdkKey},t.prototype.onReady=function(e){var r=this;e===void 0&&(e={});var i,n=Fl;e&&e.timeout!==void 0&&(n=e.timeout);var o=new Promise(function(a){i=setTimeout(function(){a({success:!1,reason:"TIMEOUT",message:"failed to initialize onReady before timeout, either the datafile or user info was not set before the timeout",dataReadyPromise:r.dataReadyPromise})},n)});return Promise.race([this.dataReadyPromise,o]).then(function(a){return clearTimeout(i),a})},t.prototype.getUserContextInstance=function(e){if(!this._client)return y.warn('Unable to get user context for user id "%s" because Optimizely client failed to initialize.',e.id),null;var r=null;return this.userContext?Wn(e,this.user)?this.userContext:e.id?(r=this._client.createUserContext(e.id,e.attributes),r):null:e.id?(this.userContext=this._client.createUserContext(e.id,e.attributes),this.userContext):null},t.prototype.setUser=function(e){var r=this;e.id&&(this.user.id=e.id,this.isUserReady=!0,this._client?this.userContext=this._client.createUserContext(e.id,e.attributes):y.warn('Unable to create user context for user id "%s" because Optimizely client failed to initialize.',this.user.id)),e.attributes&&(this.user.attributes=e.attributes),this.isUserPromiseResolved||(this.userPromiseResolver(this.user),this.isUserPromiseResolved=!0),this.onUserUpdateHandlers.forEach(function(i){return i(r.user)})},t.prototype.onUserUpdate=function(e){var r=this;return this.onUserUpdateHandlers.push(e),function(){var i=r.onUserUpdateHandlers.indexOf(e);i>-1&&r.onUserUpdateHandlers.splice(i,1)}},t.prototype.onForcedVariationsUpdate=function(e){var r=this;return this.onForcedVariationsUpdateHandlers.push(e),function(){var i=r.onForcedVariationsUpdateHandlers.indexOf(e);i>-1&&r.onForcedVariationsUpdateHandlers.splice(i,1)}},t.prototype.isReady=function(){return this.isUserReady&&this.isClientReady},t.prototype.activate=function(e,r,i){if(!this._client)return y.warn('Unable to activate experiment "%s" because Optimizely client failed to initialize.',e),null;var n=this.getUserContextWithOverrides(r,i);return n.id===null?(y.info('Unable to activate experiment "%s" because User ID is not set',e),null):this._client.activate(e,n.id,n.attributes)},t.prototype.decide=function(e,r,i,n){if(r===void 0&&(r=[]),!this._client)return y.warn('Unable to evaluate feature "%s" because Optimizely client failed to initialize.',e),Be(e,"Unable to evaluate flag "+e+" because Optimizely client failed to initialize.",this.user);var o=this.getUserContextWithOverrides(i,n);if(o.id===null)return y.info('Unable to evaluate feature "%s" because User ID is not set.',e),Be(e,"Unable to evaluate flag "+e+" because User ID is not set.",o);var a=this.getUserContextInstance(o);return a?D({},a.decide(e,r),{userContext:{id:o.id,attributes:o.attributes}}):Be(e,"Not Evaluating flag "+e+" because user id or attributes are not valid",o)},t.prototype.decideForKeys=function(e,r,i,n){if(r===void 0&&(r=[]),!this._client)return y.warn("Unable to evaluate features for keys because Optimizely client failed to initialize."),{};var o=this.getUserContextWithOverrides(i,n);if(o.id===null)return y.info("Unable to evaluate features for keys because User ID is not set"),{};var a=this.getUserContextInstance(o);return a?Object.entries(a.decideForKeys(e,r)).reduce(function(u,s){var l=s[0],c=s[1];return u[l]=D({},c,{userContext:{id:o.id||"",attributes:o.attributes}}),u},{}):{}},t.prototype.decideAll=function(e,r,i){if(e===void 0&&(e=[]),!this._client)return y.warn("Unable to evaluate all feature decisions because Optimizely client is not initialized."),{};var n=this.getUserContextWithOverrides(r,i);if(n.id===null)return y.info("Unable to evaluate all feature decisions because User ID is not set"),{};var o=this.getUserContextInstance(n);return o?Object.entries(o.decideAll(e)).reduce(function(a,u){var s=u[0],l=u[1];return a[s]=D({},l,{userContext:{id:n.id||"",attributes:n.attributes}}),a},{}):{}},t.prototype.getVariation=function(e,r,i){if(!this._client)return y.warn('Unable to get variation for experiment "%s" because Optimizely client failed to initialize.',e),null;var n=this.getUserContextWithOverrides(r,i);return n.id===null?(y.info('Unable to get variation for experiment "%s" because User ID is not set',e),null):this._client.getVariation(e,n.id,n.attributes)},t.prototype.track=function(e,r,i,n){if(!this._client){y.warn('Unable to send tracking event "%s" because Optimizely client failed to initialize.',e);return}typeof r<"u"&&typeof r!="string"&&(n=r,r=void 0,i=void 0);var o=this.getUserContextWithOverrides(r,i);if(o.id===null){y.info('Unable to send tracking event "%s" because User ID is not set',e);return}this._client.track(e,o.id,o.attributes,n)},t.prototype.setForcedDecision=function(e,r){if(!this.userContext){y.warn("Unable to set a forced decision because the user context has not been set yet.");return}var i=this.userContext.setForcedDecision(e,r);i&&(this.forcedDecisionFlagKeys.add(e.flagKey),Et.notify(e.flagKey))},t.prototype.getForcedDecision=function(e){return this.userContext?this.userContext.getForcedDecision(e):(y.warn("Unable to get a forced decision because the user context has not been set yet."),null)},t.prototype.removeForcedDecision=function(e){if(!this.userContext)return y.warn("Unable to remove forced decisions because the user context has not been set yet."),!1;var r=this.userContext.removeForcedDecision(e);return r&&(this.forcedDecisionFlagKeys.delete(e.flagKey),Et.notify(e.flagKey)),r},t.prototype.removeAllForcedDecisions=function(){if(!this.userContext)return y.warn("Unable to remove all forced decisions because the user context has not been set yet."),!1;var e=this.userContext.removeAllForcedDecisions();return e&&(this.forcedDecisionFlagKeys.forEach(function(r){return Et.notify(r)}),this.forcedDecisionFlagKeys.clear()),e},t.prototype.isFeatureEnabled=function(e,r,i){if(!this._client)return y.warn('Unable to determine if feature "%s" is enabled because Optimizely client failed to initialize.',e),!1;var n=this.getUserContextWithOverrides(r,i);return n.id===null?(y.info('Unable to determine if feature "%s" is enabled because User ID is not set',e),!1):this._client.isFeatureEnabled(e,n.id,n.attributes)},t.prototype.getFeatureVariables=function(e,r,i){var n=this;if(!this._client)return y.warn('Unable to get feature variables for feature "%s" because Optimizely client failed to initialize.',e),{};var o=this.getUserContextWithOverrides(r,i),a=o.id;if(a===null)return y.warn('Unable to get feature variables for feature "%s" because User ID is not set',e),{};var u=o.attributes,s={},l=this._client.getOptimizelyConfig();if(!l)return y.warn('Unable to retrieve feature variables for feature "%s" because Optimizely client failed to initialize.',e),{};var c=l.featuresMap[e];return c?(Object.keys(c.variablesMap).forEach(function(f){var E=c.variablesMap[f];s[E.key]=n._client.getFeatureVariable(e,E.key,a,u)}),s):(y.info('Unable to retrieve feature variables for feature "%s" because config features map is not set',e),{})},t.prototype.getFeatureVariableString=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable string from feature "%s" because Optimizely client failed to initialize.',e),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable string from feature "%s" because User ID is not set',e),null):this._client.getFeatureVariableString(e,r,o.id,o.attributes)},t.prototype.getFeatureVariableBoolean=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable boolean from feature "%s" because Optimizely client failed to initialize.',e),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable boolean from feature "%s" because User ID is not set',e),null):this._client.getFeatureVariableBoolean(e,r,o.id,o.attributes)},t.prototype.getFeatureVariableInteger=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable integer from feature "%s" because Optimizely client failed to initialize.',e),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable integer from feature "%s" because User ID is not set',e),null):this._client.getFeatureVariableInteger(e,r,o.id,o.attributes)},t.prototype.getFeatureVariableDouble=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable double from feature "%s" because Optimizely client failed to initialize.',e),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable double from feature "%s" because User ID is not set',e),null):this._client.getFeatureVariableDouble(e,r,o.id,o.attributes)},t.prototype.getFeatureVariableJSON=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable JSON from feature "%s" because Optimizely client failed to initialize.',e),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable JSON from feature "%s" because User ID is not set',e),null):this._client.getFeatureVariableJSON(e,r,o.id,o.attributes)},t.prototype.getFeatureVariable=function(e,r,i,n){if(!this._client)return y.warn('Unable to get feature variable from feature "%s" because Optimizely client failed to initialize.',e,r),null;var o=this.getUserContextWithOverrides(i,n);return o.id===null?(y.info('Unable to get feature variable from feature "%s" because User ID is not set',e,r),null):this._client.getFeatureVariable(e,r,o.id,o.attributes)},t.prototype.getAllFeatureVariables=function(e,r,i){if(!this._client)return y.warn('Unable to get all feature variables from feature "%s" because Optimizely client failed to initialize.',e),{};var n=this.getUserContextWithOverrides(r,i);return n.id===null?(y.info('Unable to get all feature variables from feature "%s" because User ID is not set',e),{}):this._client.getAllFeatureVariables(e,n.id,n.attributes)},t.prototype.getEnabledFeatures=function(e,r){if(!this._client)return y.warn("Unable to get list of enabled features because Optimizely client failed to initialize."),[];var i=this.getUserContextWithOverrides(e,r);return i.id===null?(y.info("Unable to get list of enabled features because User ID is not set"),[]):this._client.getEnabledFeatures(i.id,i.attributes)},t.prototype.getForcedVariation=function(e,r){if(!this._client)return y.warn('Unable to get forced variation for experiment "%s" because Optimizely client failed to initialize.',e),null;var i=this.getUserContextWithOverrides(r);return i.id===null?(y.info('Unable to get forced variation for experiment "%s" because User ID is not set',e),null):this._client.getForcedVariation(e,i.id)},t.prototype.setForcedVariation=function(e,r,i){if(!this._client)return y.warn('Unable to set forced variation for experiment "%s" because Optimizely client failed to initialize.',e),!1;var n=null,o=null;if(arguments.length===2)o=r,n=this.getUserContextWithOverrides().id;else if(arguments.length===3){if(n=this.getUserContextWithOverrides(r).id,i===void 0)return!1;o=i}if(n===null)return y.warn('Unable to set forced variation for experiment "%s" because User ID is not set',e),!1;var a=this._client.setForcedVariation(e,n,o);return this.onForcedVariationsUpdateHandlers.forEach(function(u){return u()}),a},t.prototype.getOptimizelyConfig=function(){return this._client?this._client.getOptimizelyConfig():(y.warn("Unable to get Optimizely configuration because Optimizely client failed to initialize."),null)},t.prototype.close=function(){return this._client?this._client.close():new Promise(function(e,r){return e({success:!0,reason:"Optimizely client is not initialized."})})},Object.defineProperty(t.prototype,"client",{get:function(){return this._client?this._client:(y.warn("Unable to get client because Optimizely client failed to initialize."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"notificationCenter",{get:function(){return this._client?this._client.notificationCenter:{addNotificationListener:function(){return y.warn("Unable to add notification listener because Optimizely client failed to initialize."),0},removeNotificationListener:function(){return y.warn("Unable to remove notification listener because Optimizely client failed to initialize."),!1},clearAllNotificationListeners:function(){y.warn("Unable to clear all notification listeners because Optimizely client failed to initialize.")},clearNotificationListeners:function(){y.warn("Unable to clear notification listeners because Optimizely client failed to initialize.")}}},enumerable:!0,configurable:!0}),t.prototype.getUserContextWithOverrides=function(e,r){var i=e===void 0?this.user.id:e,n=r===void 0?this.user.attributes:r;return{id:i,attributes:n}},t}();function Ml(t){return new xl(t)}var kl=gt.getLogger("ReactSDK"),Gl={dispatchEvent:function(t,e){kl.debug("Event not dispatched by disabled event dispatcher: %s",function(){var r;try{r=JSON.stringify(t)}catch{r="error stringifying event"}return r}),e({statusCode:204})}};Object.defineProperty(L,"OptimizelyDecideOption",{enumerable:!0,get:function(){return ie.OptimizelyDecideOption}});Object.defineProperty(L,"enums",{enumerable:!0,get:function(){return ie.enums}});Object.defineProperty(L,"errorHandler",{enumerable:!0,get:function(){return ie.errorHandler}});Object.defineProperty(L,"eventDispatcher",{enumerable:!0,get:function(){return ie.eventDispatcher}});Object.defineProperty(L,"logging",{enumerable:!0,get:function(){return ie.logging}});Object.defineProperty(L,"setLogLevel",{enumerable:!0,get:function(){return ie.setLogLevel}});Object.defineProperty(L,"setLogger",{enumerable:!0,get:function(){return ie.setLogger}});L.OptimizelyContext=Ue;L.OptimizelyContextConsumer=Hn;L.OptimizelyContextProvider=qn;L.OptimizelyExperiment=Ll;L.OptimizelyFeature=Ul;L.OptimizelyProvider=Tl;L.OptimizelyVariation=Pl;L.createInstance=Ml;L.logOnlyEventDispatcher=Gl;L.useDecision=Al;L.useExperiment=Jn;L.useFeature=Zn;L.withOptimizely=Sl});function Xr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function xo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Xr(Object(r),!0).forEach(function(i){Mo(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xr(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function Mo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ko=function(e){var r=e.orgId,i=e.namespace,n=i===void 0?"FS":i,o=e.debug,a=e.host,u=a===void 0?"fullstory.com":a,s=e.script,l=s===void 0?"edge.fullstory.com/s/fs.js":s;if(!r)throw new Error("FullStory orgId is a required parameter");window._fs_host=u,window._fs_script=l,window._fs_org=r,window._fs_namespace=n,function(c,f,E,v,R,_,g,O){if(E in c){c.console&&c.console.log&&c.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');return}g=c[E]=function(h,N,S){g.q?g.q.push([h,N,S]):g._api(h,N,S)},g.q=[],_=f.createElement(v),_.async=1,_.crossOrigin="anonymous",_.src="https://"+_fs_script,O=f.getElementsByTagName(v)[0],O.parentNode.insertBefore(_,O),g.identify=function(h,N,S){g(R,{uid:h},S),N&&g(R,N,S)},g.setUserVars=function(h,N){g(R,h,N)},g.event=function(h,N,S){g("event",{n:h,p:N},S)},g.anonymize=function(){g.identify(!1)},g.shutdown=function(){g("rec",!1)},g.restart=function(){g("rec",!0)},g.log=function(h,N){g("log",[h,N])},g.consent=function(h){g("consent",!arguments.length||h)},g.identifyAccount=function(h,N){_="account",N=N||{},N.acctId=h,g(_,N)},g.clearUserCookie=function(){},g.setVars=function(h,N){g("setVars",[h,N])},g._w={},O="XMLHttpRequest",g._w[O]=c[O],O="fetch",g._w[O]=c[O],c[O]&&(c[O]=function(){return g._w[O].apply(this,arguments)}),g._v="1.3.0"}(window,document,window._fs_namespace,"script","user")},Ve=function(){return window[window._fs_namespace]},Go=function(){var e=!!Ve();if(!e)throw Error("FullStory is not loaded, please ensure the init function is invoked before calling FullStory API functions")},Ko=function(){Go();for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return r.every(function(n){return Ve()[n]})},Q=function(e){return function(){if(window._fs_dev_mode){var r="FullStory is in dev mode and is not recording: ".concat(e," method not executed");return console.warn(r),r}if(Ko(e)){var i;return(i=Ve())[e].apply(i,arguments)}return console.warn("FS.".concat(e," not ready")),null}},Bo=Q("event"),uc=Q("log"),lc=Q("getCurrentSessionURL"),Jr=Q("identify"),cc=Q("setUserVars"),fc=Q("consent"),jo=Q("shutdown"),dc=Q("restart"),pc=Q("anonymize"),Ec=Q("setVars"),zo=function(e,r){var i=xo({},e);if(Ve()){console.warn("The FullStory snippet has already been defined elsewhere (likely in the <head> element)");return}if(i.recordCrossDomainIFrames&&(window._fs_run_in_iframe=!0),i.recordOnlyThisIFrame&&(window._fs_is_outer_script=!0),i.debug===!0&&(i.script?console.warn("Ignoring `debug = true` because `script` is set"):i.script="edge.fullstory.com/s/fs-debug.js"),ko(i),r&&Ve()("observe",{type:"start",callback:r}),i.devMode===!0){var n="FullStory was initialized in devMode and will stop recording";Bo("FullStory Dev Mode",{message_str:n}),jo(),window._fs_dev_mode=!0,console.warn(n)}},Ho=function(e,r){return function(){if(window._fs_initialized){r&&console.warn(r);return}e.apply(void 0,arguments),window._fs_initialized=!0}},Zr=Ho(zo,"FullStory init has already been called once, additional invocations are ignored");var Yo="o-1A0H2C-na1",gc=({devMode:t,userId:e}={})=>{Zr({orgId:Yo,devMode:t,debug:!1,namespace:"fs_hs"}),Jr(e)};var fe=V(Lo());var Wo="Paywall|Social_Networks|Free_Users",Xo="social_networks",Jo="web.dashboard.social_networks",Zo={paywallPrefix:Wo,paywall:Xo,TRACKING_ORIGIN:Jo},Qr=Zo;var Qo="Paywall|Scheduled_Post|Free_Users",$o="schedule_messages",ea="web.dashboard.scheduling_paywall",ta={paywallPrefix:Qo,paywall:$o,TRACKING_ORIGIN:ea},$r=ta;var ra="Paywall|Free_To_Pro_Login|Free",ia="free_pro_login",na="web.dashboard.free_pro_login",oa={paywallPrefix:ra,paywall:ia,TRACKING_ORIGIN:na},ei=oa;var aa="Paywalls|AnalyticsFree|Free_Users",sa="analytics_free",ua="web.analytics.home",la={paywallPrefix:aa,paywall:sa,TRACKING_ORIGIN:ua},ti=la;var ca="Paywall|Recommended_Post_Times|Free_Users",fa="recommended_times",da="web.dashboard.recommended_times.composer",pa={paywallPrefix:ca,paywall:fa,TRACKING_ORIGIN:da},ri=pa;var Ea="Paywall|RTTP_Alt1|Free_Users",ga="recommended_times",va="web.dashboard.recommended_times.planner",_a={paywallPrefix:Ea,paywall:ga,TRACKING_ORIGIN:va},ii=_a;var ha="Paywall|Canva_GenericUpgrade_NoTrial_Alt1|Free_Users",Ia="canva_campaign",ya="web.dashboard.composer",ma={paywallPrefix:ha,paywall:Ia,TRACKING_ORIGIN:ya},ni=ma;var Oa="Paywall|CanvaCampaignUpgrade_Alt1|Free_Users",Ra="canva_campaign",Ta="web.dashboard.composer",Na={paywallPrefix:Oa,paywall:Ra,TRACKING_ORIGIN:Ta},oi=Na;var Aa="Paywall|Canva_EditExistingAsset_Alt1|Free_Users",ba="canva_edit",Ua="web.dashboard.composer",Sa={paywallPrefix:Aa,paywall:ba,TRACKING_ORIGIN:Ua},ai=Sa;var Da="Paywall|Canva_Evergreen_Upgrade_Alt1|Free_Users",La="canva_composer",Ca="web.dashboard.composer",Pa={paywallPrefix:Da,paywall:La,TRACKING_ORIGIN:Ca},si=Pa;var wa="Paywall|CanvaCampaignUpgrade_Alt1|Free_Users|Composer Activation",Va="canva_composer",Fa="web.dashboard.composer",xa={paywallPrefix:wa,paywall:Va,TRACKING_ORIGIN:Fa},ui=xa;var Ma="Paywall|Canva_Evergreen_Upgrade_Alt1|Free_Users|Temp",ka="canva_composer",Ga="web.dashboard.composer",Ka={paywallPrefix:Ma,paywall:ka,TRACKING_ORIGIN:Ga},li=Ka;var Ba="Paywall|HashtagRecommendations_Alt2|Free_Users",ja="hashtag_suggestions_composer",za="web.dashboard.composer",Ha={paywallPrefix:Ba,paywall:ja,TRACKING_ORIGIN:za},ci=Ha;var fi=[$r,Qr,ei,ti,ri,ii,ai,ni,oi,si,ui,li,ci];var Ze=t=>fi.find(({paywallPrefix:e})=>qa(t,e)),qa=(t,e)=>{let r=e.replace(/\|/g,"\\|");return new RegExp(`^${r}[-_a-zA-Z0-9s]*$`).test(t)};Gr();var Rt=async function(t,e,r){let i=await Xe(),n=Ze(t)?.paywall;return!i||!n||!e?null:{event:"paywall_engagement",action:e,userId:i,paywall:n,...r&&{eventLabel:r}}};Fr();var At=V(Nt());var me={IMPRESSION:"impression",DISMISSED:"dismissed",ACCEPT:"accept"},Ya={plan:hs.memberPlan,host:"pendo"},bt=function(t,e,r){let i={...Ya,...r};Ye.trackCustom(e,t,i)},Wa=async function(t,e,r){switch(e){case me.IMPRESSION:await Xa(t,r);break;case me.DISMISSED:Ja(t);break;case me.ACCEPT:await Za(t,r);break}},Ut=function(t){if(t&&t.name)return Ze(t.name)?.TRACKING_ORIGIN},Xa=async function(t,e){let r=await Rt(t.name,me.IMPRESSION,e);r&&(0,At.trackGAEvent)(r),bt("paywall_opened",Ut(t),{paywallId:t.id})},Ja=function(t){bt("paywall_close_clicked",Ut(t))},Za=async function(t,e){let r=await Rt(t.name,me.ACCEPT,e);r&&(0,At.trackGAEvent)(r),bt("paywall_upgrade_clicked",Ut(t))};var St=V(Do()),Dt=()=>$a(Qa()),Qa=()=>St.default.getFeatures().map(t=>t.c).filter(t=>St.default.isFeatureEnabled(t)),$a=t=>t.filter(e=>e.includes("PENDO"));var Lt=V(Fo()),di=V(Nt());Gr();Wr();Fr();var $e=V(Mr()),es=(t,e="")=>{let r=document.getElementById("pendo-base");t.parentElement.insertBefore(r,t);let i=r.querySelector("._pendo-step-container-size");i.style.cssText=e},ts=(t,e="")=>{if(window.pendo&&!window.pendo.designerEnabled){let r=document.getElementById("pendo-base"),i=r.cloneNode(!0);r.style.display="none",i.id=void 0;let n=i.querySelector("._pendo-step-container-size"),o=t.children&&t.children[0];o&&o.remove(),t.append(i),n.style.cssText=e}},rs=async({entrypoint:t,paywallType:e,paywallVariation:r,paywallExperiment:i,acceptButtons:n=[document.querySelector("._pendo-button-primaryButton")],dismissButtons:o=[document.querySelector("._pendo-button-tertiaryButton"),document.querySelector("._pendo-close-guide")],product_area:a,guideName:u=ns(),guideId:s=os(),forceTrack:l})=>{if(!(Boolean(l)||(0,$e.env)()===$e.PRODUCTION))return;let f=is(u),E=`web.paywalls.${t}`,v=await Xe(),R=await kr(),_=O=>{(0,di.trackGAEvent)({event:"paywall_engagement",action:O,userId:v,paywall:f})},g=O=>{Ye.trackCustom(E,O,{guide_id:s,guide_segment:as(),user_plan_type:R,entrypoint:t,paywall_name:f,paywall_type:e,paywall_experiment:i,product_area:a,paywall_variation:r})};_("impression"),g("paywall_impression"),n.forEach(O=>{O&&O.addEventListener("click",()=>{_("accept"),g("paywall_clicked")})}),o.forEach(O=>{O&&O.addEventListener("click",()=>{_("dismissed"),g("paywall_dismissed")})})};function is(t){return t.split("|")[1]||t}var Ct=()=>window.pendo&&window.pendo.getActiveGuide(),ns=()=>{let t=Ct();return t&&t.guide.name},os=()=>{let t=Ct();return t&&t.guide.id},as=()=>{let t=Ct();if(!t)return;let r=Lt.default.get(t,["guide","audience"],[]).find(i=>i.segment);return Lt.default.get(r,["segment","id"],void 0)},Pt={inlinePaywallBefore:es,inlinePaywallInside:ts,registerTracking:rs,loadChilipiperWidget:qr,emitPendoEvent:jr,emitOpenSocialNetworkExpirationEvent:zr};var wt=t=>({has_entitlement_impact:t.entryPoints.canAccessImpact,has_entitlement_amplify_composer:t.entryPoints.canAccessAmplifyComposer,has_entitlement_insights_by_brandwatch:t.entryPoints.canAccessInsightsByBrandwatch});Wr();var nc=V(we()),ht=V(be()),It=V(Ur());var Qn=V(be());var Se="production",De="staging",Le="dev",ze=()=>{let t=Bl(),e=String(Kl().env||t.TARGET||t.NODE_ENV).toLowerCase();return e.includes("dev")?Le:e.includes("stag")?De:Se},Kl=()=>typeof hs<"u"?hs:{},Bl=()=>typeof process<"u"&&process.env?process.env:{};var jl="HoGBxc43fBdoejnKKJMfs",zl="6xNorXhBfHzRvHvS6Lv35",Hl="4iqEUNUjbX25mnQaSNojK";function $n(){switch(ze()){case Se:return Hl;case De:return zl;case Le:return jl;default:throw new Error("Invalid env")}}function eo(){let{LOG_LEVEL:t}=Qn.enums;switch(ze()){case Se:return t.ERROR;case De:return t.ERROR;case Le:return t.INFO;default:throw new Error("Invalid env")}}var to=V(be());xr();var ql=(t,e)=>{let r="frontend";return t.length===0&&(t=`${r}.${e}`),t.indexOf(r)===0?t:`${r}.`+t},Yl=(t,e,r,i)=>We("frontend.logging",t,ql(e,t),r,i),Wl={ERROR:"error",INFO:"info"},Ie=(t,e,r)=>Yl(Wl.ERROR,t,e,r);var ro={log:(t,e)=>{let{LOG_LEVEL:r}=to.enums;switch(t){case r.INFO:case r.DEBUG:console.log(e);break;case r.WARNING:console.warn(e);break;case r.ERROR:console.error(e),Ie("web.frontend.optimizely",e);break}}};wo();var Sr=V(we());var io=V(we());var Dr=typeof window>"u"?{}:window,no=()=>(Dr.__doNotUse=Dr.__doNotUse||{},Dr.__doNotUse),ye=t=>no()[t],Ce=(t,e)=>{let r=no();return r[t]=e,ye(t)};var co=V(Po());var Zl=new Set(["@@redux/INIT","@@INIT"]),oo=t=>Zl.has(t);var Lr=(t=[],e)=>{try{if(e==null||!t.length)return e;let[r,...i]=t;return Lr(i,e[r])}catch{return}};var ao=(t,e)=>{if(t==null)throw new Error(`

Missing Event Type`);let r=t.split(/[/]/),i=Lr(r,e);if(i==null)throw new Error(`

Invalid handler: ${t}`);return i};var so=(t,e,r)=>{};var uo=(t,e)=>(r={},i={})=>{let{type:n,payload:o=[]}=i;var a=r;try{if(oo(n))return r;a=ao(n,e).call(null,r,...o)}catch(u){so(t,u,i)}return a};var lo=typeof window<"u"?window.__REDUX_DEVTOOLS_EXTENSION__:()=>{},fo=(t,e,r)=>{let i=uo(t,e),n=lo&&lo({name:t}),o=(0,co.createStore)(i,r,n);return{store:o,getState:o.getState.bind(o),subscribe:o.subscribe.bind(o),dispatch:(a,...u)=>o.dispatch({type:a,payload:u})}};var po={set:{actionHistory:(t,e)=>e,actionHistoryValue:(t,e,r)=>({...t,[e]:r})},delete:{actionHistoryValue:(t,e)=>{let r={...t};return delete r[e],r}}};var Cr="fe-pg-lib-action-history",Ql=window.hs?.memberActionHistory||{},Pr=ye(Cr);Pr||(Pr=Ce(Cr,fo(Cr,po,Ql)));var{store:$l,dispatch:Eo,getState:wr,subscribe:ec}=Pr;var He=t=>wr()[t];var go=V(Vo()),vo=ye("axios")||Ce("axios",go.default);var vt=class{constructor(){this.queue=[],this.isTaskInProgress=!1}schedule(e){return new Promise((r,i)=>{this.queue.push({task:e,resolve:r,reject:i}),this.execute()})}execute(){if(this.isTaskInProgress)return;let e=this.queue.shift();!e||(this.isTaskInProgress=!0,e.task().then(r=>{e.resolve(r),this.isTaskInProgress=!1,this.execute()}).catch(r=>{e.reject(r),this.isTaskInProgress=!1,this.execute()}))}};var tc={[Le]:"https://dashboard.local.hootdev.com",[De]:"https://staging.hootsuite.com",[Se]:"https://hootsuite.com"},rc=tc[ze()],_o=()=>ye("action-history-scheduler");_o()||Ce("action-history-scheduler",new vt);var qe=async(t,e)=>(await Eo("set/actionHistoryValue",t,e),window.hs?.memberActionHistory&&(window.hs.memberActionHistory[t]=e),_o().schedule(()=>vo.post(rc+"/ajax/member/store-action-history-value",{n:t,v:e,csrfToken:window.hs?.csrfToken},{withCredentials:!0})).then(()=>!0));var ho=V(we());xr();var Io="fe-lib-optimizely";function yo(t,e){let r=`optimizely.experiment.${t}`;if(He(r)!==e){let n={id:t,variation:e};Ot(Io,"experiment_started",n),qe(r,e),We("optimizely:experiment:started",n)}}function mo(t){Ot(Io,t.eventKey,t.eventTags)}function Oo(t){let e=t!==void 0?t:window?.hs?.memberId;if(e===void 0)throw Ie("web.frontend.fe-lib-optimizely","Member ID is undefined"),new Error("Missing member ID");return String(e)}function Ro(t={}){let e={countryCode:window?.hs?.countryCode,language:window?.hs?.language,isInTrial:window?.hs?.inTrial,accountAge:window?.hs?.memberExtras?.accountAgeInDays,planCode:window?.hs?.memberPlan,hasInheritedPlanCodes:window?.hs?.memberInheritedPlanCodes&&window.hs.memberInheritedPlanCodes.length>1,trialDuration:window?.hs?.memberUtil?.getTrialDuration(),...t};return Object.keys(e).forEach(r=>{e[r]===void 0&&(Ie("web.frontend.fe-lib-optimizely",`User attribute '${r}' is undefined`),delete e[r])}),e}var To="optimizely.experiment_bucket_map";function _t(t={}){let e=He(To);if(e===void 0)return t;try{return JSON.parse(e)}catch{return Ie("web.frontend.fe-lib-optimizely","Failed to parse experiment bucket map from action history"),t}}function ic(t){qe(To,JSON.stringify(t))}var No={lookup:t=>({user_id:t,experiment_bucket_map:_t()}),save:t=>{ic(t.experiment_bucket_map)}};var up=V(be()),lp=V(Ur()),Ao,oc;function ac(t){return({decisionInfo:e})=>{let r=t.getOptimizelyConfig(),i=e.ruleKey,n=i!==null&&r?.experimentsMap?.[i]!==void 0;e.enabled&&n&&yo(i,e.variationKey)}}function bo(){let t=(0,ht.createInstance)({datafile:window.optimizelyDatafile,sdkKey:$n(),logLevel:eo(),logger:ro,userProfileService:No});if(t===null)throw new Error("Failed to create Optimizely SDK instance");return t.notificationCenter.addNotificationListener(ht.enums.NOTIFICATION_TYPES.TRACK,mo),t.notificationCenter.addNotificationListener(It.enums.NOTIFICATION_TYPES.DECISION,ac(t)),t}async function op(t={}){let e={id:Oo(t.userId),attributes:await Ro(t.userAttributes)},r=Ao??bo();await r.onReady();let i=r.createUserContext(e.id,e.attributes);if(i===null)throw new Error("Failed to create Optimizely user context");return i}function ap(t){if(!t)return null;let e=window.optimizelyDatafile?.experiments?.find(o=>o.key===t);if(!e)return null;let i=_t()[e.id]?.variation_id;return i&&e.variations.find(o=>o.id===i)?.key||null}function Uo(){let t=Ao||oc||bo(),e={},r=_t(),i=t?.getOptimizelyConfig()?.experimentsMap;return i!==void 0&&Object.values(i).forEach(({id:n,key:o,variationsMap:a})=>{let u="off";if(Object.keys(r).includes(n)){let{variation_id:s}=r[n];u=Object.values(a).find(c=>c.id===s)?.key||"off"}e[o]=u}),e}function gp(){sc();var t=window.pendo||{};if(t.initialize&&hs.memberId&&hs.env){let r=function(){Je({data:{social_account_max_reached:Hr()}})},i=function(){Je({data:{is_org_member:Kr()}})},n=function(f){f&&f.id&&Je({data:{["experiment_"+f.id]:f.variation}})};fe.default.on(ae.SOCIAL_NETWORK_REFRESH_SUCCESS,r),fe.default.on(ae.TEAM_MANAGEMENT_ORG_LIST_RENDERED,i),fe.default.on(ae.TEAM_MANAGEMENT_ORG_LIST_ITEM_RENDERED,i),fe.default.on(ae.OPTIMIZELY_EXPERIMENT_STARTED,n);let o={getting_started_has_completed_schedule_post_task:de.getActionHistoryValue("getting_started.has_completed_schedule_post_task"),getting_started_progress:de.getActionHistoryValue("getting_started.progress"),getting_started_task_create_post:de.getActionHistoryValue("getting_started.task.create_post"),getting_started_task_visit_analytics:de.getActionHistoryValue("getting_started.task.visit_analytics"),getting_started_task_visit_planner:de.getActionHistoryValue("getting_started.task.visit_planner")},a=de.getSnTypeUniqList(),u=Dt(),s=wt(hs),l=Uo();for(var e in l)l["experiment_"+e]=l[e],delete l[e];let c=Br(o,a,u,s,l);t.initialize({excludeAllText:!0,visitor:c,events:{ready:function(){fe.default.emit(ae.PENDO_READY),Yr()},guidesLoaded:function(){fe.default.emit(ae.PENDO_GUIDES_LOADED)},guidesFailed:function(){fe.default.emit(ae.PENDO_GUIDES_FAILED)}},account:{}})}window.pendoHelpers=Pt}function sc(){(function(t,e,r,i,n){var o,a,u;for(n=t[i]=t[i]||{},n._q=n._q||[],o=["initialize","identify","updateOptions","pageLoad","track","getSerializedMetadata"],a=0,u=o.length;a<u;++a)(function(s){n[s]=n[s]||function(){n._q[s===o[0]?"unshift":"push"]([s].concat([].slice.call(arguments,0)))}})(o[a])})(window,document,"script","pendo")}export{gc as a,me as b,Wa as c,op as d,ap as e,gp as f};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
//# sourceMappingURL=chunk-S3XACRGS.js.map
